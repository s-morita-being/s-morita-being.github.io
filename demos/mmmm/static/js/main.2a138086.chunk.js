(this["webpackJsonpmmmm-react"]=this["webpackJsonpmmmm-react"]||[]).push([[0],{38:function(t,e,n){t.exports=n(52)},43:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),a=n(35),o=n.n(a),c=(n(43),n(20)),s=n(11),u=n.n(s),l=n(28),h=n(2),f=n(7),m=n(8),d=n(37),v=function(){function t(){Object(f.a)(this,t),this.undos=[],this.redos=[],this.current=null,this.completed=new d.a}return Object(m.a)(t,[{key:"_assertInTransaction",value:function(){if(null===this.current)throw new Error("must be in transaction")}},{key:"_assertNotInTransaction",value:function(){if(null!==this.current)throw new Error("must not be in transaction")}},{key:"_replay",value:function(t,e){this.begin();var n=t.pop();n.actions.forEach((function(t){return t()})),e.push({message:n.message,actions:this.current}),this.current=null,this.completed.next()}},{key:"begin",value:function(){this._assertNotInTransaction(),this.current=[]}},{key:"commit",value:function(t){this._assertInTransaction(),this.redos.length=0,this.undos.push({message:t,actions:this.current}),this.current=null,this.completed.next()}},{key:"cancel",value:function(){this._assertInTransaction();var t=this.current;this.current=[],t.forEach((function(t){return t()})),this.current=null,this.completed.next()}},{key:"clear",value:function(){this._assertNotInTransaction(),this.undos.length=this.redos.length=0}},{key:"undo",value:function(){this._replay(this.undos,this.redos)}},{key:"redo",value:function(){this._replay(this.redos,this.undos)}},{key:"record",value:function(t){this._assertInTransaction(),this.current.unshift(t)}}]),t}(),p=n(27),b=n(13),g=n(23),y=n(12),_=n(24),x=n(22),O=function(){function t(e){var n=e.text;Object(f.a)(this,t),this.modified=new d.a,this._text=n||""}return Object(m.a)(t,[{key:"_setText",value:function(t){var e=this,n=this._text;this.root.session.record((function(){return e._setText(n)})),this._text=t,this.modified.next()}},{key:"toJSON",value:function(){return{text:this._text}}},{key:"text",get:function(){return this._text},set:function(t){t!==this._text&&this._setText(t)}}]),t}(),w=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t,i){var r,a=i.id,o=i.marginX,c=i.marginY,s=i.children,u=Object(p.a)(i,["id","marginX","marginY","children"]);return Object(f.a)(this,n),(r=e.call(this,u)).root=t.parent.root,r.parent=t,r.children=new j(Object(b.a)(r),s),r.id="number"===typeof a?a:r.root._newID(),r._marginX=o||0,r._marginY=c||0,r}return Object(m.a)(n,[{key:"_setParent",value:function(t){var e=this,n=this.parent;this.root.session.record((function(){return e._setParent(n)})),this.parent=t}},{key:"_setMarginX",value:function(t){var e=this,n=this._marginX;this.root.session.record((function(){return e._setMarginX(n)})),this._marginX=t,this.modified.next()}},{key:"_setMarginY",value:function(t){var e=this,n=this._marginY;this.root.session.record((function(){return e._setMarginY(n)})),this._marginY=t,this.modified.next()}},{key:"toJSON",value:function(){return Object.assign(Object(g.a)(Object(y.a)(n.prototype),"toJSON",this).call(this),{id:this.id,marginX:0!==this._marginX?this._marginX:void 0,marginY:0!==this._marginY?this._marginY:void 0,children:this.children.toJSON()})}},{key:"index",get:function(){return this.parent._items.indexOf(this)}},{key:"remove",value:function(){var t=this.index;this.parent._splice(t,1);var e=this.parent._items;return t<e.length&&(e[t].marginY+=this._marginY),t}},{key:"isAncestorOf",value:function(t){for(var e=t.parent;e instanceof n;){if(e===this)return!0;e=e.parent.parent}return!1}},{key:"moveInto",value:function(t,e){if(this.isAncestorOf(t))throw new Error("cannot move into self");var n=this.remove();this.marginY=0,t===this.parent?e>n&&--e:this._setParent(t),t._add(e,this)}},{key:"marginX",get:function(){return this._marginX},set:function(t){t<0&&(t=0),t!==this._marginX&&this._setMarginX(t)}},{key:"marginY",get:function(){return this._marginY},set:function(t){this!==this.parent._items[0]&&t<0&&(t=0),t!==this._marginY&&this._setMarginY(t)}}]),n}(O),j=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.items,a=i.collapsed;Object(f.a)(this,t),this.parent=e,this._items=r?r.map((function(t){return new w(n,t)})):[],this._collapsed=!!a}return Object(m.a)(t,[{key:"_splice",value:function(t,e){for(var n,i=this,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var s=(n=this._items).splice.apply(n,[t,e].concat(a));this.parent.root.session.record((function(){return i._splice.apply(i,[t,a.length].concat(Object(c.a)(s)))})),this.parent.modified.next()}},{key:"_add",value:function(t,e){if(t<this._items.length){var n=this._items[t],i=[n.marginY,0];e.marginY=i[0],n.marginY=i[1]}this._splice(t,0,e)}},{key:"toJSON",value:function(){return this._items.length>0?{items:this._items.map((function(t){return t.toJSON()})),collapsed:!!this._collapsed||void 0}:void 0}},{key:Symbol.iterator,value:function(){return this._items[Symbol.iterator]()}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new w(this,e);return this._add(t,n),n}},{key:"collapsed",get:function(){return this._collapsed}},{key:"collapsed",set:function(t){t!==this._collapsed&&(this._collapsed=t,this.parent.modified.next(),this.parent.root.session.completed.next())}}]),t}(),k=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.nextID,o=r.left,c=r.right,s=Object(p.a)(r,["nextID","left","right"]);return Object(f.a)(this,n),(i=e.call(this,s)).session=t,i._nextID=a||0,i.left=new j(Object(b.a)(i),o),i.right=new j(Object(b.a)(i),c),i}return Object(m.a)(n,[{key:"_setNextID",value:function(t){var e=this,n=this._nextID;this.session.record((function(){return e._setNextID(n)})),this._nextID=t}},{key:"_newID",value:function(){var t=this._nextID;return this._setNextID(t+1),t}},{key:"toJSON",value:function(){return Object.assign(Object(g.a)(Object(y.a)(n.prototype),"toJSON",this).call(this),{nextID:this._nextID,left:this.left.toJSON(),right:this.right.toJSON()})}},{key:"root",get:function(){return this}}]),n}(O),E=n(5),C=n(54),M=n(58),S=n(57),D=n(55),Y=n(56),T=function(){function t(e,n){var i=this;Object(f.a)(this,t),this.model=n,this.subscription=n.modified.subscribe((function(){return i._dirty()})),e?(this.width=e.nextWidth,this.height=e.nextHeight,this.focused=new C.a(e.focused.value),this.anchored=new C.a(e.anchored.value),this.selected=new C.a(e.selected.value)):(this.width=this.height=0,this.focused=new C.a(!1),this.anchored=new C.a(!1),this.selected=new C.a(!1)),this.nextWidth=this.width,this.nextHeight=this.height}return Object(m.a)(t,[{key:"nextSize",value:function(t,e){t===this.width&&e===this.height||(this.nextWidth=t,this.nextHeight=e,this._dirty())}},{key:"selectClear",value:function(){this.selected.value&&this.selected.next(!1)}}]),t}(),P=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t,i,r){var a;return Object(f.a)(this,n),(a=e.call(this,t,r)).parent=i,a.children=new A(t&&t.children,Object(b.a)(a),r.children),a.top=Math.min(a.children.top,0),a.bottom=Math.max(a.children.bottom,a.height),a}return Object(m.a)(n,[{key:"_dispose",value:function(){this.subscription.unsubscribe(),this.children._dispose()}},{key:"_dirty",value:function(){this.subscription.closed||(this.subscription.unsubscribe(),this.parent.parent._dirty())}},{key:"_detach",value:function(){this.parent._detach()}},{key:"_moveX",value:function(t){var e=this.model.marginX+t;e<0&&(this.parent.parent._moveX(e),e=0),this.model.marginX=e}},{key:"_moveUpTop",value:function(t){(t+=this.top-this.children.top)>0&&this.parent._moveUpTop(t,this)}},{key:"_moveUpBottom",value:function(t){(t=this.bottom-Math.max(this.children.bottom-t,this.height))>0&&this.parent._moveUpBottom(t,this)}},{key:"_moveDownTop",value:function(t){(t=Math.min(this.children.top+t,0)-this.top)>0&&this.parent._moveDownTop(t,this)}},{key:"_moveDownBottom",value:function(t){(t-=this.bottom-this.children.bottom)>0&&this.parent._moveDownBottom(t,this)}},{key:"move",value:function(t,e){this.subscription.closed||this._detach(),this._moveX(t),this.parent._moveY(e,this)}},{key:"selectClear",value:function(){Object(g.a)(Object(y.a)(n.prototype),"selectClear",this).call(this),this.children._selectClear()}},{key:"position",get:function(){for(var t=0,e=0,n=this;;){t+=n.model.marginX;var i=n.parent;if(e+=i.items[i.indexOf(n)].y,(n=i.parent)instanceof N)return t+=.5*(n.width+n.height),i===n.left&&(t=-t-this.width),[t,e-.5*n.height];t+=n.width+n.height}}}]),n}(T),A=function(){function t(e,n,i,r){var a=this;Object(f.a)(this,t),this.parent=n,this.model=i;var o=e?new Map(e.items.map((function(t){return[t.item.model,t.item]}))):new Map;this.items=Array.from(i,(function(t){var e=o.get(t);return o.delete(t),!e||e.subscription.closed?e=new P(e,a,t):e.parent=a,{item:e,y:t.marginY}}));var c,s=Object(E.a)(o.values());try{for(s.s();!(c=s.n()).done;){c.value._dispose()}}catch(_){s.e(_)}finally{s.f()}var u=this.items.length;if(u<=0)this.top=this.bottom=0;else if(i.collapsed){this.top=this.bottom=0;var l,h=Object(E.a)(this.items);try{for(h.s();!(l=h.n()).done;){l.value.y=0}}catch(_){h.e(_)}finally{h.f()}}else{var m=this.items[0],d=m.y;this.top=d+m.item.top;for(var v=0;this.bottom=m.y+m.item.bottom,!(++v>=u);)(m=this.items[v]).y+=this.bottom-m.item.top;var p=.5*(m.y-d);this.top-=p,this.bottom-=p;var b,g=Object(E.a)(this.items);try{for(g.s();!(b=g.n()).done;){b.value.y-=p}}catch(_){g.e(_)}finally{g.f()}}var y=function(t){var e,n=Object(E.a)(a.items);try{for(n.s();!(e=n.n()).done;){var i=e.value.item;if(i[t].value)return i;var r=i.children[t];if(r)return r}}catch(_){n.e(_)}finally{n.f()}return null};this.focused=y("focused"),this.anchored=y("anchored"),this.selecteds=this.items.reduce((function(t,e){var n=e.item;return t+(n.selected.value?1:0)+n.children.selecteds}),0)}return Object(m.a)(t,[{key:"_dispose",value:function(){var t,e=Object(E.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item._dispose()}}catch(n){e.e(n)}finally{e.f()}}},{key:"_detach",value:function(){var t,e=Object(E.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item.subscription.unsubscribe()}}catch(n){e.e(n)}finally{e.f()}this.parent._detach()}},{key:"__moveUpTop",value:function(t,e){for(;e>0;--e){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY-=.5*t,this.parent._moveUpTop(t)}},{key:"_moveUpTop",value:function(t,e){var n=this.indexOf(e);n>0?this.__moveUpTop(t,n):this.parent._moveUpTop(t)}},{key:"_moveUpBottom",value:function(t,e){var n=this.indexOf(e)+1;n<this.items.length?this.items[n].item.model.marginY+=t:this.parent._moveUpBottom(t)}},{key:"_moveDownTop",value:function(t,e){var n=this.indexOf(e);n>0?this.items[n].item.model.marginY+=t:this.parent._moveDownTop(t)}},{key:"__moveDownBottom",value:function(t,e){for(;++e<this.items.length;){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY+=.5*t,this.parent._moveDownBottom(t)}},{key:"_moveDownBottom",value:function(t,e){var n=this.indexOf(e);n+1<this.items.length?this.__moveDownBottom(t,n):this.parent._moveDownBottom(t)}},{key:"_moveY",value:function(t,e){var n=this.indexOf(e);t<0?(t=-t,this.__moveUpTop(t,n),n+1<this.items.length?this.items[n+1].item.model.marginY+=t:(this.items[0].item.model.marginY-=.5*t,this.parent._moveUpBottom(t))):t>0&&(this.__moveDownBottom(t,n),n>0?this.items[n].item.model.marginY+=t:(this.items[0].item.model.marginY+=.5*t,this.parent._moveDownTop(t)))}},{key:"_selectClear",value:function(){if(!(this.selecteds<=0)){var t,e=Object(E.a)(this.items);try{for(e.s();!(t=e.n()).done;){t.value.item.selectClear()}}catch(n){e.e(n)}finally{e.f()}this.selecteds=0}}},{key:"indexOf",value:function(t){return this.items.findIndex((function(e){return e.item===t}))}}]),t}(),N=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(f.a)(this,n),(i=e.call(this,r,t)).left=new A(r&&r.left,Object(b.a)(i),t.left),i.right=new A(r&&r.right,Object(b.a)(i),t.right),i._current=new C.a(i._getCurrent("focused")),i}return Object(m.a)(n,[{key:"_dirty",value:function(){this.subscription.unsubscribe()}},{key:"_detach",value:function(){this.subscription.unsubscribe()}},{key:"_find",value:function(t){return t===this.model.left?this.left:t===this.model.right?this.right:this.find(t.parent).children}},{key:"_moveX",value:function(t){}},{key:"_moveUpTop",value:function(t){}},{key:"_moveUpBottom",value:function(t){}},{key:"_moveDownTop",value:function(t){}},{key:"_moveDownBottom",value:function(t){}},{key:"_path",value:u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===this){t.next=6;break}return t.next=3,e;case 3:e=e.parent.parent,t.next=0;break;case 6:case"end":return t.stop()}}),t,this)}))},{key:"_getCurrent",value:function(t){return this[t].value?this:this.left[t]||this.right[t]}},{key:"_setCurrent",value:function(t,e){var n=this._getCurrent(t);if(e===n)return!1;if(n){var i,r=Object(E.a)(this._path(n));try{for(r.s();!(i=r.n()).done;){i.value.parent[t]=null}}catch(c){r.e(c)}finally{r.f()}n[t].next(!1)}if(e){var a,o=Object(E.a)(this._path(e));try{for(o.s();!(a=o.n()).done;){a.value.parent[t]=e}}catch(c){o.e(c)}finally{o.f()}e[t].next(!0)}return!0}},{key:"dispose",value:function(){this.subscription.unsubscribe(),this.left._dispose(),this.right._dispose()}},{key:"next",value:function(){return this.subscription.closed?new n(this.model,this):this}},{key:"find",value:function(t){return t===this.model?this:this._find(t.parent).items[t.index].item}},{key:"current",get:function(){return this._current},set:function(t){this._setCurrent("focused",t)&&this._current.next(this._getCurrent("focused"))}},{key:"anchor",get:function(){return this._getCurrent("anchored")},set:function(t){this._setCurrent("anchored",t)}},{key:"selectClear",value:function(){Object(g.a)(Object(y.a)(n.prototype),"selectClear",this).call(this),this.left._selectClear(),this.right._selectClear()}},{key:"selectSet",value:function(t,e){if(e!==t.selected.value){t.selected.next(e);var n,i=e?1:-1,r=Object(E.a)(this._path(t));try{for(r.s();!(n=r.n()).done;){n.value.parent.selecteds+=i}}catch(a){r.e(a)}finally{r.f()}}}},{key:"selectRange",value:function(t,e){for(var n=this,i=function(t){var e,i=[],r=Object(E.a)(n._path(t));try{for(r.s();!(e=r.n()).done;){var a=e.value;i.unshift(a)}}catch(o){r.e(o)}finally{r.f()}return i.unshift(n),i},r=[i(t),i(e)],a=r[0],o=r[1];a.length>1&&o.length>1&&a[1].parent===o[1].parent;)a.shift(),o.shift();var c=function t(e,i){if(n.selectSet(e,!0),--i>0){var r,a=Object(E.a)(e.children.items);try{for(a.s();!(r=a.n()).done;){t(r.value.item,i)}}catch(o){a.e(o)}finally{a.f()}}},s=function(t,e,i){for(;t.length>1;){--e,t.shift(),n.selectSet(t[0],!0);for(var r=t[0].parent.items,a=i(t[0]),o=Object(h.a)(a,2),s=o[0],u=o[1];s<u;++s)c(r[s].item,e)}if(--e>0){var l,f=Object(E.a)(t[0].children.items);try{for(f.s();!(l=f.n()).done;){var m=l.value;c(m.item,e)}}catch(d){f.e(d)}finally{f.f()}}},u=function(t){return s(a,t,(function(t){return[t.parent.indexOf(t)+1,t.parent.items.length]}))},l=function(t){return s(o,t,(function(t){return[0,t.parent.indexOf(t)]}))},f=Math.max(a.length,o.length);if(this.selectSet(a[0],!0),a[0]===this){if(a.length>1&&o.length>1&&a[1].parent===this.right){var m=[o,a];a=m[0],o=m[1]}a.length>1&&u(f),o.length>1&&l(f)}else{var d=a[0].parent,v=[d.indexOf(a[0]),d.indexOf(o[0])],p=v[0],b=v[1];if(p===b)(a.length>1?u:l)(f);else{if(this.selectSet(o[0],!0),p>b){var g=[o,a,b,p];a=g[0],o=g[1],p=g[2],b=g[3]}for(u(f);++p<b;)c(d.items[p].item,f);l(f)}}}},{key:"position",get:function(){return[.5*-this.width,.5*-this.height]}}]),n}(T),X=n(4),I=function(){function t(e){var n=this;Object(f.a)(this,t),this.model=e,this.layout=new C.a(new N(e)),this.translate=new C.a({x:0,y:0}),this.scale=new C.a(1),this.editorDefault={input:function(t){var e=n.layout.value.current.value.model,i=e.text;n.begin(),e.text=t,n.editor.next({input:function(t){n.cancel(),n.begin(),e.text=t,n.model.session.completed.next()},commit:function(){n.editor.next(n.editorDefault),e.text===i?n.cancel():n.commit("Edit")},cancel:function(){n.editor.next(n.editorDefault),n.cancel()}}),n.model.session.completed.next()},commit:function(){},cancel:function(){}},this.editor=new C.a(this.editorDefault);var i=this.model.session,r=i.undos,a=i.redos,o=function(){return[["Undo".concat(r.length>0?" - ".concat(r[r.length-1].message):""),X.o,r.length>0?function(){return n._editorCommitAnd((function(){return i.undo()}))}:null],["Redo".concat(a.length>0?" - ".concat(a[a.length-1].message):""),X.l,a.length>0?function(){return n._editorCommitAnd((function(){return i.redo()}))}:null]]};this.menu=new C.a(o());var c=function(){if(n.editor.value!==n.editorDefault)return[[["Cancel (Esc)",X.m,function(){return n.editor.value.cancel()}]],[],[["Commit (Enter)",X.b,function(){return n.editor.value.commit()}]],[],[],[],[],[]];var t=n.layout.value;if(!t.current.value)return[[],[],[],[],[],[],[],[]];var e=function(){return n._editorCommitAnd((function(){return n.editor.value.input(n.layout.value.current.value.model.text)}))},i=function(t,e){return t.collapsed?["Expand ".concat(e),X.g,function(){return n._editorCommitAnd((function(){return t.collapsed=!1}))}]:["Collapse ".concat(e),X.e,function(){return n._editorCommitAnd((function(){return t.collapsed=!0}))}]};if(t.current.value===t)return[[],[],[["Edit",X.f,e]],t.right.items.length>0?[i(t.model.right,"Right Items")]:[["Add Right",X.k,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.right.add(0,{text:"Right"})),n.commit("Add right")}))}))}]],[],[],[],t.left.items.length>0?[i(t.model.left,"Left Items")]:[["Add Left",X.k,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.left.add(0,{text:"Left"})),n.commit("Add left")}))}))}]]];for(var r=[[],[["Add Above",X.k,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index,{text:"Above"})),n.commit("Add item above")}))}))}]],[["Edit",X.f,e]],t.current.value.children.items.length>0?[i(t.current.value.model.children,"Children")]:[["Add Child",X.k,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.current.value.model.children.add(0,{text:"Child"})),n.commit("Add child")}))}))}]],[],[["Add Below",X.k,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index+1,{text:"Below"})),n.commit("Add item below")}))}))}]],[["Delete",X.n,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=function t(e){if(!(e.selecteds<=0)){var n,i=Object(E.a)(e.items);try{for(i.s();!(n=i.n()).done;){var r=n.value.item;r.selected.value?r.model.remove():t(r.children)}}catch(a){i.e(a)}finally{i.f()}}},e=n.layout.value;t(e.left),t(e.right),n.commit("Delete items")}))}))}]],[["Move Elsewhere",X.a,function(){return n.moveElsewhere(n.layout.value.current.value)}]]],a=t.current.value.parent;a.parent!==t;)a=a.parent.parent;return a===t.left?[r[2],r[1],r[0],r[7],r[6],r[5],r[4],r[3]]:r};this.manipulator=new C.a(c()),this._kick=new d.a,this._kick.pipe(Object(D.a)((function(){return Object(M.a)(null,S.a)})),Object(Y.a)()).subscribe((function(){n.menu.next(o()),n.manipulator.next(c())})),this.completed=i.completed.subscribe((function(){n.next(),n._kick.next()}))}return Object(m.a)(t,[{key:"_withTransaction",value:function(t){this.begin();try{t()}catch(e){this.cancel()}}},{key:"_editorCommitAnd",value:function(t){this.editor.value.commit(),t()}},{key:"dispose",value:function(){this.completed.unsubscribe(),this.layout.value.dispose()}},{key:"next",value:function(){var t=this.layout.value,e=t.next();e!==t&&this.layout.next(e)}},{key:"begin",value:function(){this.model.session.begin()}},{key:"commit",value:function(t){this.model.session.commit(t)}},{key:"cancel",value:function(){this.model.session.cancel()}},{key:"select",value:function(t,e,n){var i=this.layout.value;i.current=t,e?(i.anchor||(i.anchor=t),n||i.selectClear(),i.selectRange(i.anchor,t)):(i.anchor=t,n?i.selectSet(t,!t.selected.value):t.selected.value||(i.selectClear(),i.selectSet(t,!0))),this._kick.next()}},{key:"selectClear",value:function(){var t=this.layout.value;t.current=t.anchor=null,t.selectClear(),this._kick.next()}},{key:"selectByModel",value:function(t){this.next();var e=this.layout.value,n=e.find(t);e.current=e.anchor=n,e.selectClear(),e.selectSet(n,!0),this._kick.next()}},{key:"pan",value:function(t,e){var n=this,i=this.translate.value,r=i.x,a=i.y,o={moved:!1,move:function(i,c){n.translate.next({x:r-t+i,y:a-e+c}),o.moved=!0}};return o}},{key:"zoom",value:function(t,e,n){var i=this.scale.value,r=Math.min(Math.max(i*n,.125),4),a=r/i,o=this.translate.value,c=o.x,s=o.y;this.translate.next({x:t+(c-t)*a,y:e+(s-e)*a}),this.scale.next(r)}},{key:"move",value:function(t,e,n){var i=this;this.editor.value.commit();var r=0,a=0;return this.begin(),{end:function(){0===r&&0===a?i.cancel():i.commit("Move item")},move:function(o,c){i.cancel(),i.begin(),r=o-e,a=c-n;var s=i.scale.value;t.move(r/s,a/s),i.model.session.completed.next()}}}},{key:"moveElsewhere",value:function(t){var e,n=this;return this.editor.value.commit(),{end:function(){var i=e,r=Object(h.a)(i,2),a=r[0],o=r[1],c=t.model.index;(a!==t.parent||o!==c&&o!==c+1)&&n._withTransaction((function(){t.model.moveInto(a.model,o),n.selectByModel(t.model),n.commit("Move item elsewhere")}))},move:function(i,r){var a=n.translate.value,o=n.scale.value,c=n.layout.value,s=[(i-a.x)/o,(r-a.y)/o+.5*c.height];r=s[1];var u=(i=s[0])>0?1:-1;i*=u;var l=e=function e(n,a,o,c){var s=n.items.length;if(s<=0)return[n,0,a,o,c];n.model.collapsed=!1;var u=n.items[0],l=0;do{var h=n.items[l],f=o+h.y;if(f+h.item.top>r)break;if(u=h,f+.5*h.item.height>r)break}while(++l<s);if(u.item===t)return[n,l,a,o,c];var m=a+c+u.item.model.marginX+u.item.width;return m>i?[n,l,a,o,c]:e(u.item.children,m,o+u.y,u.item.height)}(u>0?c.right:c.left,.5*c.width,0,.5*c.height),f=Object(h.a)(l,5),m=f[0],d=f[1],v=f[2],p=f[3],b=f[4];p-=.5*c.height;var g=m.items.length,y=g>0?function(t){return t.y+t.item[d<g?"top":"bottom"]+.25*t.item.height}(m.items[d<g?d:g-1]):b;return"M ".concat(v*u,",").concat(p+b," C ").concat((v+.5*b)*u,",").concat(p+b," ").concat(v*u,",").concat(p+y," ").concat((v+b)*u,",").concat(p+y," a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*.5," 0 a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*-.5," 0")}}}}]),t}(),B=n(36),R=(n(50),r.a.forwardRef((function(t,e){var n=t.cursor,a=t.onPointerDown,o=t.children,c=Object(p.a)(t,["cursor","onPointerDown","children"]),s=Object(i.useState)(null),u=Object(h.a)(s,2),l=u[0],f=u[1];return r.a.createElement("div",Object.assign({ref:e,style:{cursor:l?l.cursor:n},onPointerDown:function(t){t.preventDefault(),t.stopPropagation(),l||(t.currentTarget.setPointerCapture(t.pointerId),f(a(t)))},onPointerUp:function(t){t.stopPropagation(),t.currentTarget.releasePointerCapture(t.pointerId),l&&(l.onPointerUp(t),f(null))},onPointerMove:function(t){t.stopPropagation(),l&&l.onPointerMove(t)}},c),o)}))),U=r.a.createContext();function J(t){var e=Object(i.useState)(t.focused.value),n=Object(h.a)(e,2),a=n[0],o=n[1],c=Object(i.useState)(t.selected.value),s=Object(h.a)(c,2),u=s[0],l=s[1],f=Object(i.useRef)();Object(i.useLayoutEffect)((function(){t.nextSize(f.current.offsetWidth,f.current.offsetHeight);var e=t.focused.subscribe(o);return e.add(t.selected.subscribe(l)),function(){return e.unsubscribe()}}),[t]);var m=Object(i.useContext)(U),d=Object(i.useState)(a&&m.editor.value),v=Object(h.a)(d,2),p=v[0],b=v[1],g=Object(i.useRef)();return Object(i.useLayoutEffect)((function(){if(a){g.current.focus();var t=m.editor.subscribe(b);return function(){return t.unsubscribe()}}b(null)}),[m,t,a]),Object(i.useLayoutEffect)((function(){if(g.current)if(p===m.editorDefault)g.current.innerText="";else if(t.model.text!==g.current.innerText){g.current.innerText=t.model.text;var e=window.getSelection();e.removeAllRanges(),e.selectAllChildren(g.current)}}),[m,t,p]),[u,f,a?r.a.createElement("div",{style:{position:"relative"}},t.model.text,r.a.createElement("div",{ref:g,contentEditable:!0,className:"MindMap-input".concat(p===m.editorDefault?"":" active"),onInput:function(t){return m.editor.value.input(t.target.innerText)},onBlur:function(t){return m.editor.value.commit()},onKeyDown:function(t){switch(t.key){case"Enter":m.editor.value.commit();break;case"Escape":m.editor.value.cancel();break;default:return}t.preventDefault(),t.stopPropagation()},onPointerDown:function(t){return t.stopPropagation()}})):t.model.text]}function L(t){var e=t.item,n=t.direction,a=Object(i.useContext)(U),o=J(e),c=Object(h.a)(o,3),s=c[0],u=c[1],l=c[2];return r.a.createElement("div",{style:{transform:"translateX(".concat(n<0?-e.width:0,"px)")}},r.a.createElement(R,{ref:u,className:"MindMap-item".concat(s?" selected":""),onPointerDown:function(t){a.select(e,t.shiftKey,t.ctrlKey);var i=a.move(e,t.clientX*n,t.clientY);return{cursor:"grabbing",onPointerUp:function(){return i.end()},onPointerMove:function(t){return i.move(t.clientX*n,t.clientY)}}}},l),r.a.createElement("div",{style:{transform:"translateX(".concat(n<0?0:e.width,"px)")}},r.a.createElement(W,{items:e.children,direction:n,dy:e.height})))}function W(t){var e=t.items,n=t.direction,i=t.dy;return e.items.length<=0?null:e.model.collapsed?r.a.createElement("span",{className:"MindMap-collapsed",onPointerDown:function(t){return t.stopPropagation()},onClick:function(){return e.model.collapsed=!1},title:"Expand"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},r.a.createElement("path",{d:"M 0,".concat(i," h ").concat(i*n*.25," a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*.5," 0 a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*-.5," 0")}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},e.items.map((function(t){var e=t.y,a=t.item;return r.a.createElement("path",{key:a.model.id,className:"line",d:"M 0,".concat(i," C ").concat(i*n*.5,",").concat(i," 0,").concat(e+a.height," ").concat(i*n,",").concat(e+a.height," h ").concat((a.model.marginX+a.width)*n)})}))),e.items.map((function(t){var e=t.y,a=t.item;return r.a.createElement("div",{key:a.model.id,style:{transform:"translate(".concat((i+a.model.marginX)*n,"px, ").concat(e,"px)")}},r.a.createElement(L,{item:a,direction:n}))})))}function z(t){var e=t.items;return r.a.createElement(r.a.Fragment,null,e.map((function(t,e){var n=Object(h.a)(t,3),i=n[0],a=n[1],o=n[2];return r.a.createElement("div",{key:e,className:o?"":"disabled",title:i,onPointerDown:function(t){t.preventDefault(),o&&(t.manipulator=o(),t.manipulator)||t.stopPropagation()}},r.a.createElement(B.a,{icon:a,fixedWidth:!0}))})))}function K(){var t=Object(i.useContext)(U),e=Object(i.useState)(t.layout.value),n=Object(h.a)(e,2),a=n[0],o=n[1],s=Object(i.useState)(a.current.value),u=Object(h.a)(s,2),l=u[0],f=u[1],m=Object(i.useState)(t.translate.value),d=Object(h.a)(m,2),v=d[0],p=d[1],b=Object(i.useState)(t.scale.value),g=Object(h.a)(b,2),y=g[0],_=g[1],x=Object(i.useState)(t.manipulator.value),O=Object(h.a)(x,2),w=O[0],j=O[1];Object(i.useEffect)((function(){var e=t.layout.subscribe((function(t){o(t),f(t.current.value)}));return e.add(t.translate.subscribe(p)),e.add(t.scale.subscribe(_)),e.add(t.manipulator.subscribe(j)),function(){return e.unsubscribe()}}),[t]),Object(i.useEffect)((function(){var t=a.current.subscribe(f);return function(){return t.unsubscribe()}}),[a]);var k=J(a),E=Object(h.a)(k,3),C=E[0],M=E[1],S=E[2];Object(i.useLayoutEffect)((function(){return t.next()}));var D=Object(i.useState)({left:0,top:0,width:0,height:0}),Y=Object(h.a)(D,2),T=Y[0],P=Y[1],A=Object(i.useRef)();Object(i.useEffect)((function(){var t=new ResizeObserver((function(){return P(A.current.getBoundingClientRect())}));return t.observe(A.current),function(){return t.disconnect()}}),[]);var N=Object(i.useState)(),X=Object(h.a)(N,2),I=X[0],B=X[1],L=Object(i.useRef)(),K=Object(i.useRef)(),F=Object(i.useRef)(),H=Object(i.useRef)(),G=Object(i.useRef)(),$=Object(i.useRef)(),q=Object(i.useRef)(),Q=Object(i.useRef)(),V=Object(i.useState)([]),Z=Object(h.a)(V,2),tt=Z[0],et=Z[1];return Object(i.useLayoutEffect)((function(){if(l&&!I){var t=[].concat(Object(c.a)(l.position),[l.width,l.height]).map((function(t){return t*y})),e=Object(h.a)(t,4),n=e[0],i=e[1],r=e[2],a=e[3];n+=v.x+.5*T.width,i+=v.y+.5*T.height,et([[L,0,0,1,1],[K,.5,0,.5,1],[F,1,0,0,1],[H,1,.5,0,.5],[G,1,1,0,0],[$,.5,1,.5,0],[q,0,1,1,0],[Q,0,.5,1,.5]].map((function(t,e){var o=Object(h.a)(t,5),c=o[0],s=o[1],u=o[2],l=o[3],f=o[4],m=c.current.getBoundingClientRect();return"translate(".concat(n+r*s-m.width*l,"px, ").concat(i+a*u-m.height*f,"px)")})))}}),[a,l,v,y,w,T,I]),r.a.createElement(R,{ref:A,className:"MindMap-viewport",cursor:"grab",onPointerDown:function(e){var n=e.manipulator;if(n)return e.manipulator=null,B(n.move(e.clientX-.5*T.width,e.clientY-.5*T.height)),{cursor:"grabbing",onPointerUp:function(){B(null),n.end()},onPointerMove:function(t){return B(n.move(t.clientX-.5*T.width,t.clientY-.5*T.height))}};var i=t.pan(e.clientX,e.clientY),r=e.target===A.current;return{cursor:"grabbing",onPointerUp:function(e){i.moved||(t.editor.value.commit(),r&&t.selectClear())},onPointerMove:function(t){return i.move(t.clientX,t.clientY)}}},onWheel:function(e){return t.zoom(e.clientX-T.left-.5*T.width,e.clientY-T.top-.5*T.height,1-e.deltaY/256)},onScroll:function(e){t.translate.next({x:v.x-e.target.scrollLeft,y:v.y-e.target.scrollTop}),e.target.scroll(0,0)}},r.a.createElement("div",{className:"MindMap-content",style:{transformOrigin:"".concat(.5*T.width,"px ").concat(.5*T.height,"px"),transform:"translate(".concat(v.x,"px, ").concat(v.y,"px) scale(").concat(y,") translate(").concat(.5*T.width,"px, ").concat(.5*T.height,"px)")}},r.a.createElement("div",{style:{transform:"translate(".concat(-.5*a.width,"px, ").concat(-.5*a.height,"px)")}},r.a.createElement("div",{ref:M,className:"MindMap-root".concat(C?" selected":""),onPointerDown:function(e){return t.select(a,e.shiftKey,e.ctrlKey)}},S),r.a.createElement(W,{items:a.left,direction:-1,dy:.5*a.height}),r.a.createElement("div",{style:{transform:"translateX(".concat(a.width,"px)")}},r.a.createElement(W,{items:a.right,direction:1,dy:.5*a.height}))),I&&r.a.createElement("svg",{className:"MindMap-indicator",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},r.a.createElement("path",{d:I}))),!I&&[L,K,F,H,G,$,q,Q].map((function(t,e){return r.a.createElement("div",{key:e,ref:t,className:"MindMap-manipulator Menu",style:{transform:tt[e]}},r.a.createElement(z,{items:w[e]}))})))}n(51);var F=function(){var t=Object(i.useState)(),e=Object(h.a)(t,2),n=e[0],a=e[1],o=Object(i.useState)(),s=Object(h.a)(o,2),f=s[0],m=s[1],d=function(t){window.history.replaceState(null,"",window.location.origin+window.location.pathname+t),m(null)};Object(i.useLayoutEffect)((function(){Object(l.a)(u.a.mark((function t(){var e,n,i,r,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:e=t.sent,n=e.parseState(),i=Object(h.a)(n,2),r=i[0],o=i[1],t.t0=r,t.next="open"===t.t0?7:20;break;case 7:if(o===f){t.next=19;break}return t.t1=a,t.t2=k,t.t3=new v,t.next=13,e.download(o);case 13:return t.next=15,t.sent.json();case 15:t.t4=t.sent,t.t5=new t.t2(t.t3,t.t4),(0,t.t1)(t.t5),m(o);case 19:return t.abrupt("break",21);case 20:""!==f&&(a(new k(new v,{text:"\u65b0\u3057\u3044\u30de\u30a4\u30f3\u30c9\u30de\u30c3\u30d7"})),m(""));case 21:case"end":return t.stop()}}),t)})))()}),[f]);var p=Object(i.useState)(),b=Object(h.a)(p,2),g=b[0],y=b[1];Object(i.useLayoutEffect)((function(){y(n?new I(n):null)}),[n]),Object(i.useLayoutEffect)((function(){return g?function(){return g.dispose()}:void 0}),[g]);var _=Object(i.useRef)(),x=Object(i.useRef)(),O=Object(i.useState)([]),w=Object(h.a)(O,2),j=w[0],E=w[1];return Object(i.useEffect)((function(){if(g){var t=g.menu.subscribe((function(t){return E([["New",X.h,function(){return d("")}],["Open",X.c,function(){g.editor.value.commit(),Object(l.a)(u.a.mark((function t(){var e,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:return e=t.sent,t.next=5,e.pickFile();case 5:(n=t.sent)&&d(e.buildState(n));case 7:case"end":return t.stop()}}),t)})))()}],["Save",X.d,function(){g.editor.value.commit(),Object(l.a)(u.a.mark((function t(){var e,i,r,a,o,c,s,l;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:if(e=t.sent,i=JSON.stringify(n.toJSON(),null,"  "),!f){t.next=9;break}return t.next=7,e.upload(f,i);case 7:t.next=25;break;case 9:if(r=e.parseState(),a=Object(h.a)(r,2),o=a[0],c=a[1],"create"!==o){t.next=14;break}t.t0=c,t.next=17;break;case 14:return t.next=16,e.pickFolder();case 16:t.t0=t.sent;case 17:if(s=t.t0){t.next=20;break}return t.abrupt("return");case 20:return t.next=22,e.create(s,i);case 22:l=t.sent,m(l),d(e.buildState(l));case 25:case"end":return t.stop()}}),t)})))()}]].concat(Object(c.a)(t),[["Upload",X.j,function(){g.editor.value.commit(),_.current.click()}],["Download",X.i,function(){g.editor.value.commit(),x.current.click()}]]))}));return function(){return t.unsubscribe()}}}),[n,f,g]),r.a.createElement("div",{className:"App"},r.a.createElement("input",{ref:_,type:"file",style:{display:"none"},onChange:function(){var t=Object(l.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.target,t.t0=a,t.t1=k,t.t2=new v,t.t3=JSON,t.next=7,n.files[0].text();case 7:t.t4=t.sent,t.t5=t.t3.parse.call(t.t3,t.t4),t.t6=new t.t1(t.t2,t.t5),(0,t.t0)(t.t6),n.value="";case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}),r.a.createElement("a",{ref:x,href:" ",download:!0,style:{display:"none"},onClick:function(t){t.target.href="data:application/json,"+encodeURIComponent(JSON.stringify(n.toJSON(),null,"  "))}}," "),g&&r.a.createElement(U.Provider,{value:g},r.a.createElement(K,null)),r.a.createElement("div",{className:"Menu"},r.a.createElement(z,{items:j})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(F,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[38,1,2]]]);
//# sourceMappingURL=main.2a138086.chunk.js.map