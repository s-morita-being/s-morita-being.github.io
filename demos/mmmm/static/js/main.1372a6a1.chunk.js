(this["webpackJsonpmmmm-react"]=this["webpackJsonpmmmm-react"]||[]).push([[0],{38:function(t,e,n){t.exports=n(52)},43:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){"use strict";n.r(e);var i=n(0),r=n.n(i),a=n(36),o=n.n(a),c=(n(43),n(5)),s=n.n(c),u=n(18),l=n(1),h=n(8),m=n(9),f=n(37),d=function(){function t(){Object(h.a)(this,t),this.undos=[],this.redos=[],this.current=null,this.completed=new f.a}return Object(m.a)(t,[{key:"_assertInTransaction",value:function(){if(null===this.current)throw new Error("must be in transaction")}},{key:"_assertNotInTransaction",value:function(){if(null!==this.current)throw new Error("must not be in transaction")}},{key:"_replay",value:function(t,e){this.begin();var n=t.pop();n.actions.forEach((function(t){return t()})),e.push({message:n.message,actions:this.current}),this.current=null,this.completed.next()}},{key:"begin",value:function(){this._assertNotInTransaction(),this.current=[]}},{key:"commit",value:function(t){this._assertInTransaction(),this.redos.length=0,this.undos.push({message:t,actions:this.current}),this.current=null,this.completed.next()}},{key:"cancel",value:function(){this._assertInTransaction();var t=this.current;this.current=[],t.forEach((function(t){return t()})),this.current=null,this.completed.next()}},{key:"clear",value:function(){this._assertNotInTransaction(),this.undos.length=this.redos.length=0}},{key:"undo",value:function(){this._replay(this.undos,this.redos)}},{key:"redo",value:function(){this._replay(this.redos,this.undos)}},{key:"record",value:function(t){this._assertInTransaction(),this.current.unshift(t)}}]),t}(),v=n(32),p=n(27),b=n(13),g=n(23),y=n(12),_=n(24),x=n(22),O=["id","marginX","marginY","children"],w=["nextID","left","right"],j=function(){function t(e){var n=e.text;Object(h.a)(this,t),this.modified=new f.a,this._text=n||""}return Object(m.a)(t,[{key:"_setText",value:function(t){var e=this,n=this._text;this.root.session.record((function(){return e._setText(n)})),this._text=t,this.modified.next()}},{key:"toJSON",value:function(){return{text:this._text}}},{key:"text",get:function(){return this._text},set:function(t){t!==this._text&&this._setText(t)}}]),t}(),k=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t,i){var r,a=i.id,o=i.marginX,c=i.marginY,s=i.children,u=Object(p.a)(i,O);return Object(h.a)(this,n),(r=e.call(this,u)).root=t.parent.root,r.parent=t,r.children=new E(Object(b.a)(r),s),r.id="number"===typeof a?a:r.root._newID(),r._marginX=o||0,r._marginY=c||0,r}return Object(m.a)(n,[{key:"_setParent",value:function(t){var e=this,n=this.parent;this.root.session.record((function(){return e._setParent(n)})),this.parent=t}},{key:"_setMarginX",value:function(t){var e=this,n=this._marginX;this.root.session.record((function(){return e._setMarginX(n)})),this._marginX=t,this.modified.next()}},{key:"_setMarginY",value:function(t){var e=this,n=this._marginY;this.root.session.record((function(){return e._setMarginY(n)})),this._marginY=t,this.modified.next()}},{key:"toJSON",value:function(){return Object.assign(Object(g.a)(Object(y.a)(n.prototype),"toJSON",this).call(this),{id:this.id,marginX:0!==this._marginX?this._marginX:void 0,marginY:0!==this._marginY?this._marginY:void 0,children:this.children.toJSON()})}},{key:"index",get:function(){return this.parent._items.indexOf(this)}},{key:"remove",value:function(){var t=this.index;this.parent._splice(t,1);var e=this.parent._items;return t<e.length&&(e[t].marginY+=this._marginY),t}},{key:"isAncestorOf",value:function(t){for(var e=t.parent;e instanceof n;){if(e===this)return!0;e=e.parent.parent}return!1}},{key:"moveInto",value:function(t,e){if(this.isAncestorOf(t))throw new Error("cannot move into self");var n=this.remove();this.marginY=0,t===this.parent?e>n&&--e:this._setParent(t),t._add(e,this)}},{key:"marginX",get:function(){return this._marginX},set:function(t){t<0&&(t=0),t!==this._marginX&&this._setMarginX(t)}},{key:"marginY",get:function(){return this._marginY},set:function(t){this!==this.parent._items[0]&&t<0&&(t=0),t!==this._marginY&&this._setMarginY(t)}}]),n}(j),E=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.items,a=i.collapsed;Object(h.a)(this,t),this.parent=e,this._items=r?r.map((function(t){return new k(n,t)})):[],this._collapsed=!!a}return Object(m.a)(t,[{key:"_splice",value:function(t,e){for(var n,i=this,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var c=(n=this._items).splice.apply(n,[t,e].concat(a));this.parent.root.session.record((function(){return i._splice.apply(i,[t,a.length].concat(Object(v.a)(c)))})),this.parent.modified.next()}},{key:"_add",value:function(t,e){if(t<this._items.length){var n=this._items[t],i=[n.marginY,0];e.marginY=i[0],n.marginY=i[1]}this._splice(t,0,e)}},{key:"toJSON",value:function(){return this._items.length>0?{items:this._items.map((function(t){return t.toJSON()})),collapsed:!!this._collapsed||void 0}:void 0}},{key:Symbol.iterator,value:function(){return this._items[Symbol.iterator]()}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new k(this,e);return this._add(t,n),n}},{key:"collapsed",get:function(){return this._collapsed}},{key:"collapsed",set:function(t){t!==this._collapsed&&(this._collapsed=t,this.parent.modified.next(),this.parent.root.session.completed.next())}}]),t}(),C=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.nextID,o=r.left,c=r.right,s=Object(p.a)(r,w);return Object(h.a)(this,n),(i=e.call(this,s)).session=t,i._nextID=a||0,i.left=new E(Object(b.a)(i),o),i.right=new E(Object(b.a)(i),c),i}return Object(m.a)(n,[{key:"_setNextID",value:function(t){var e=this,n=this._nextID;this.session.record((function(){return e._setNextID(n)})),this._nextID=t}},{key:"_newID",value:function(){var t=this._nextID;return this._setNextID(t+1),t}},{key:"toJSON",value:function(){return Object.assign(Object(g.a)(Object(y.a)(n.prototype),"toJSON",this).call(this),{nextID:this._nextID,left:this.left.toJSON(),right:this.right.toJSON()})}},{key:"root",get:function(){return this}}]),n}(j),S=n(6),M=n(54),D=n(58),Y=n(57),N=n(55),T=n(56),I=function(){function t(e,n){var i=this;Object(h.a)(this,t),this.model=n,this.subscription=n.modified.subscribe((function(){return i._dirty()})),e?(this.width=e.nextWidth,this.height=e.nextHeight,this.focused=new M.a(e.focused.value),this.anchored=new M.a(e.anchored.value),this.selected=new M.a(e.selected.value)):(this.width=this.height=0,this.focused=new M.a(!1),this.anchored=new M.a(!1),this.selected=new M.a(!1)),this.nextWidth=this.width,this.nextHeight=this.height}return Object(m.a)(t,[{key:"nextSize",value:function(t,e){t===this.width&&e===this.height||(this.nextWidth=t,this.nextHeight=e,this._dirty())}},{key:"selectClear",value:function(){this.selected.value&&this.selected.next(!1)}}]),t}(),P=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t,i,r){var a;return Object(h.a)(this,n),(a=e.call(this,t,r)).parent=i,a.children=new A(t&&t.children,Object(b.a)(a),r.children),a.top=Math.min(a.children.top,0),a.bottom=Math.max(a.children.bottom,a.height),a}return Object(m.a)(n,[{key:"_dispose",value:function(){this.subscription.unsubscribe(),this.children._dispose()}},{key:"_dirty",value:function(){this.subscription.closed||(this.subscription.unsubscribe(),this.parent.parent._dirty())}},{key:"_detach",value:function(){this.parent._detach()}},{key:"_moveX",value:function(t){var e=this.model.marginX+t;e<0&&(this.parent.parent._moveX(e),e=0),this.model.marginX=e}},{key:"_moveUpTop",value:function(t){(t+=this.top-this.children.top)>0&&this.parent._moveUpTop(t,this)}},{key:"_moveUpBottom",value:function(t){(t=this.bottom-Math.max(this.children.bottom-t,this.height))>0&&this.parent._moveUpBottom(t,this)}},{key:"_moveDownTop",value:function(t){(t=Math.min(this.children.top+t,0)-this.top)>0&&this.parent._moveDownTop(t,this)}},{key:"_moveDownBottom",value:function(t){(t-=this.bottom-this.children.bottom)>0&&this.parent._moveDownBottom(t,this)}},{key:"move",value:function(t,e){this.subscription.closed||this._detach(),this._moveX(t),this.parent._moveY(e,this)}},{key:"selectClear",value:function(){Object(g.a)(Object(y.a)(n.prototype),"selectClear",this).call(this),this.children._selectClear()}},{key:"position",get:function(){for(var t=0,e=0,n=this;;){t+=n.model.marginX;var i=n.parent;if(e+=i.items[i.indexOf(n)].y,(n=i.parent)instanceof X)return t+=.5*(n.width+n.height),i===n.left&&(t=-t-this.width),[t,e-.5*n.height];t+=n.width+n.height}}}]),n}(I),A=function(){function t(e,n,i,r){var a=this;Object(h.a)(this,t),this.parent=n,this.model=i;var o=e?new Map(e.items.map((function(t){return[t.item.model,t.item]}))):new Map;this.items=Array.from(i,(function(t){var e=o.get(t);return o.delete(t),!e||e.subscription.closed?e=new P(e,a,t):e.parent=a,{item:e,y:t.marginY}}));var c,s=Object(S.a)(o.values());try{for(s.s();!(c=s.n()).done;){c.value._dispose()}}catch(_){s.e(_)}finally{s.f()}var u=this.items.length;if(u<=0)this.top=this.bottom=0;else if(i.collapsed){this.top=this.bottom=0;var l,m=Object(S.a)(this.items);try{for(m.s();!(l=m.n()).done;){l.value.y=0}}catch(_){m.e(_)}finally{m.f()}}else{var f=this.items[0],d=f.y;this.top=d+f.item.top;for(var v=0;this.bottom=f.y+f.item.bottom,!(++v>=u);)(f=this.items[v]).y+=this.bottom-f.item.top;var p=.5*(f.y-d);this.top-=p,this.bottom-=p;var b,g=Object(S.a)(this.items);try{for(g.s();!(b=g.n()).done;){b.value.y-=p}}catch(_){g.e(_)}finally{g.f()}}var y=function(t){var e,n=Object(S.a)(a.items);try{for(n.s();!(e=n.n()).done;){var i=e.value.item;if(i[t].value)return i;var r=i.children[t];if(r)return r}}catch(_){n.e(_)}finally{n.f()}return null};this.focused=y("focused"),this.anchored=y("anchored"),this.selecteds=this.items.reduce((function(t,e){var n=e.item;return t+(n.selected.value?1:0)+n.children.selecteds}),0)}return Object(m.a)(t,[{key:"_dispose",value:function(){var t,e=Object(S.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item._dispose()}}catch(n){e.e(n)}finally{e.f()}}},{key:"_detach",value:function(){var t,e=Object(S.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item.subscription.unsubscribe()}}catch(n){e.e(n)}finally{e.f()}this.parent._detach()}},{key:"__moveUpTop",value:function(t,e){for(;e>0;--e){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY-=.5*t,this.parent._moveUpTop(t)}},{key:"_moveUpTop",value:function(t,e){var n=this.indexOf(e);n>0?this.__moveUpTop(t,n):this.parent._moveUpTop(t)}},{key:"_moveUpBottom",value:function(t,e){var n=this.indexOf(e)+1;n<this.items.length?this.items[n].item.model.marginY+=t:this.parent._moveUpBottom(t)}},{key:"_moveDownTop",value:function(t,e){var n=this.indexOf(e);n>0?this.items[n].item.model.marginY+=t:this.parent._moveDownTop(t)}},{key:"__moveDownBottom",value:function(t,e){for(;++e<this.items.length;){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY+=.5*t,this.parent._moveDownBottom(t)}},{key:"_moveDownBottom",value:function(t,e){var n=this.indexOf(e);n+1<this.items.length?this.__moveDownBottom(t,n):this.parent._moveDownBottom(t)}},{key:"_moveY",value:function(t,e){var n=this.indexOf(e);t<0?(t=-t,this.__moveUpTop(t,n),n+1<this.items.length?this.items[n+1].item.model.marginY+=t:(this.items[0].item.model.marginY-=.5*t,this.parent._moveUpBottom(t))):t>0&&(this.__moveDownBottom(t,n),n>0?this.items[n].item.model.marginY+=t:(this.items[0].item.model.marginY+=.5*t,this.parent._moveDownTop(t)))}},{key:"_selectClear",value:function(){if(!(this.selecteds<=0)){var t,e=Object(S.a)(this.items);try{for(e.s();!(t=e.n()).done;){t.value.item.selectClear()}}catch(n){e.e(n)}finally{e.f()}this.selecteds=0}}},{key:"indexOf",value:function(t){return this.items.findIndex((function(e){return e.item===t}))}}]),t}(),X=function(t){Object(_.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(h.a)(this,n),(i=e.call(this,r,t)).left=new A(r&&r.left,Object(b.a)(i),t.left),i.right=new A(r&&r.right,Object(b.a)(i),t.right),i._current=new M.a(i._getCurrent("focused")),i}return Object(m.a)(n,[{key:"_dirty",value:function(){this.subscription.unsubscribe()}},{key:"_detach",value:function(){this.subscription.unsubscribe()}},{key:"_find",value:function(t){return t===this.model.left?this.left:t===this.model.right?this.right:this.find(t.parent).children}},{key:"_moveX",value:function(t){}},{key:"_moveUpTop",value:function(t){}},{key:"_moveUpBottom",value:function(t){}},{key:"_moveDownTop",value:function(t){}},{key:"_moveDownBottom",value:function(t){}},{key:"_path",value:s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===this){t.next=6;break}return t.next=3,e;case 3:e=e.parent.parent,t.next=0;break;case 6:case"end":return t.stop()}}),t,this)}))},{key:"_getCurrent",value:function(t){return this[t].value?this:this.left[t]||this.right[t]}},{key:"_setCurrent",value:function(t,e){var n=this._getCurrent(t);if(e===n)return!1;if(n){var i,r=Object(S.a)(this._path(n));try{for(r.s();!(i=r.n()).done;){i.value.parent[t]=null}}catch(c){r.e(c)}finally{r.f()}n[t].next(!1)}if(e){var a,o=Object(S.a)(this._path(e));try{for(o.s();!(a=o.n()).done;){a.value.parent[t]=e}}catch(c){o.e(c)}finally{o.f()}e[t].next(!0)}return!0}},{key:"dispose",value:function(){this.subscription.unsubscribe(),this.left._dispose(),this.right._dispose()}},{key:"next",value:function(){return this.subscription.closed?new n(this.model,this):this}},{key:"find",value:function(t){return t===this.model?this:this._find(t.parent).items[t.index].item}},{key:"current",get:function(){return this._current},set:function(t){this._setCurrent("focused",t)&&this._current.next(this._getCurrent("focused"))}},{key:"anchor",get:function(){return this._getCurrent("anchored")},set:function(t){this._setCurrent("anchored",t)}},{key:"selectClear",value:function(){Object(g.a)(Object(y.a)(n.prototype),"selectClear",this).call(this),this.left._selectClear(),this.right._selectClear()}},{key:"selectSet",value:function(t,e){if(e!==t.selected.value){t.selected.next(e);var n,i=e?1:-1,r=Object(S.a)(this._path(t));try{for(r.s();!(n=r.n()).done;){n.value.parent.selecteds+=i}}catch(a){r.e(a)}finally{r.f()}}}},{key:"selectRange",value:function(t,e){for(var n=this,i=function(t){var e,i=[],r=Object(S.a)(n._path(t));try{for(r.s();!(e=r.n()).done;){var a=e.value;i.unshift(a)}}catch(o){r.e(o)}finally{r.f()}return i.unshift(n),i},r=[i(t),i(e)],a=r[0],o=r[1];a.length>1&&o.length>1&&a[1].parent===o[1].parent;)a.shift(),o.shift();var c=function t(e,i){if(n.selectSet(e,!0),--i>0){var r,a=Object(S.a)(e.children.items);try{for(a.s();!(r=a.n()).done;){t(r.value.item,i)}}catch(o){a.e(o)}finally{a.f()}}},s=function(t,e,i){for(;t.length>1;){--e,t.shift(),n.selectSet(t[0],!0);for(var r=t[0].parent.items,a=i(t[0]),o=Object(l.a)(a,2),s=o[0],u=o[1];s<u;++s)c(r[s].item,e)}if(--e>0){var h,m=Object(S.a)(t[0].children.items);try{for(m.s();!(h=m.n()).done;){var f=h.value;c(f.item,e)}}catch(d){m.e(d)}finally{m.f()}}},u=function(t){return s(a,t,(function(t){return[t.parent.indexOf(t)+1,t.parent.items.length]}))},h=function(t){return s(o,t,(function(t){return[0,t.parent.indexOf(t)]}))},m=Math.max(a.length,o.length);if(this.selectSet(a[0],!0),a[0]===this){if(a.length>1&&o.length>1&&a[1].parent===this.right){var f=[o,a];a=f[0],o=f[1]}a.length>1&&u(m),o.length>1&&h(m)}else{var d=a[0].parent,v=[d.indexOf(a[0]),d.indexOf(o[0])],p=v[0],b=v[1];if(p===b)(a.length>1?u:h)(m);else{if(this.selectSet(o[0],!0),p>b){var g=[o,a,b,p];a=g[0],o=g[1],p=g[2],b=g[3]}for(u(m);++p<b;)c(d.items[p].item,m);h(m)}}}},{key:"position",get:function(){return[.5*-this.width,.5*-this.height]}}]),n}(I),B=n(4),R=function(){function t(e){var n=this;Object(h.a)(this,t),this.model=e,this.layout=new M.a(new X(e)),this.translate=new M.a({x:0,y:0}),this.scale=new M.a(1),this.editorDefault={input:function(t){var e=n.layout.value.current.value.model,i=e.text;n.begin(),e.text=t,n.editor.next({input:function(t){n.cancel(),n.begin(),e.text=t,n.model.session.completed.next()},commit:function(){n.editor.next(n.editorDefault),e.text===i?n.cancel():n.commit("Edit")},cancel:function(){n.editor.next(n.editorDefault),n.cancel()}}),n.model.session.completed.next()},commit:function(){},cancel:function(){}},this.editor=new M.a(this.editorDefault);var i=this.model.session,r=i.undos,a=i.redos,o=function(){return[["Undo".concat(r.length>0?" - ".concat(r[r.length-1].message):""),B.q,r.length>0?function(){return n._editorCommitAnd((function(){return i.undo()}))}:null],["Redo".concat(a.length>0?" - ".concat(a[a.length-1].message):""),B.m,a.length>0?function(){return n._editorCommitAnd((function(){return i.redo()}))}:null]]};this.menu=new M.a(o());var c=function(){if(n.editor.value!==n.editorDefault)return[[["Cancel (Esc)",B.o,function(){return n.editor.value.cancel()}]],[],[["Commit (Enter)",B.b,function(){return n.editor.value.commit()}]],[],[],[],[],[]];var t=n.layout.value;if(!t.current.value)return[[],[],[],[],[],[],[],[]];var e=function(){return n._editorCommitAnd((function(){return n.editor.value.input(n.layout.value.current.value.model.text)}))},i=function(t,e){return t.collapsed?["Expand ".concat(e),B.g,function(){return n._editorCommitAnd((function(){return t.collapsed=!1}))}]:["Collapse ".concat(e),B.e,function(){return n._editorCommitAnd((function(){return t.collapsed=!0}))}]};if(t.current.value===t)return[[],[],[["Edit",B.f,e]],t.right.items.length>0?[i(t.model.right,"Right Items")]:[["Add Right",B.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.right.add(0,{text:"Right"})),n.commit("Add right")}))}))}]],[],[],[],t.left.items.length>0?[i(t.model.left,"Left Items")]:[["Add Left",B.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.left.add(0,{text:"Left"})),n.commit("Add left")}))}))}]]];for(var r=[[],[["Add Above",B.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index,{text:"Above"})),n.commit("Add item above")}))}))}]],[["Edit",B.f,e]],t.current.value.children.items.length>0?[i(t.current.value.model.children,"Children")]:[["Add Child",B.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.current.value.model.children.add(0,{text:"Child"})),n.commit("Add child")}))}))}]],[],[["Add Below",B.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index+1,{text:"Below"})),n.commit("Add item below")}))}))}]],[["Delete",B.p,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=function t(e){if(!(e.selecteds<=0)){var n,i=Object(S.a)(e.items);try{for(i.s();!(n=i.n()).done;){var r=n.value.item;r.selected.value?r.model.remove():t(r.children)}}catch(a){i.e(a)}finally{i.f()}}},e=n.layout.value;t(e.left),t(e.right),n.commit("Delete items")}))}))}]],[["Move Elsewhere",B.a,function(){return n.moveElsewhere(n.layout.value.current.value)}]]],a=t.current.value.parent;a.parent!==t;)a=a.parent.parent;return a===t.left?[r[2],r[1],r[0],r[7],r[6],r[5],r[4],r[3]]:r};this.manipulator=new M.a(c()),this._kick=new f.a,this._kick.pipe(Object(N.a)((function(){return Object(D.a)(null,Y.a)})),Object(T.a)()).subscribe((function(){n.menu.next(o()),n.manipulator.next(c())})),this.completed=i.completed.subscribe((function(){n.next(),n._kick.next()}))}return Object(m.a)(t,[{key:"_withTransaction",value:function(t){this.begin();try{t()}catch(e){this.cancel()}}},{key:"_editorCommitAnd",value:function(t){this.editor.value.commit(),t()}},{key:"dispose",value:function(){this.completed.unsubscribe(),this.layout.value.dispose()}},{key:"next",value:function(){var t=this.layout.value,e=t.next();e!==t&&this.layout.next(e)}},{key:"begin",value:function(){this.model.session.begin()}},{key:"commit",value:function(t){this.model.session.commit(t)}},{key:"cancel",value:function(){this.model.session.cancel()}},{key:"select",value:function(t,e,n){var i=this.layout.value;i.current=t,e?(i.anchor||(i.anchor=t),n||i.selectClear(),i.selectRange(i.anchor,t)):(i.anchor=t,n?i.selectSet(t,!t.selected.value):t.selected.value||(i.selectClear(),i.selectSet(t,!0))),this._kick.next()}},{key:"selectClear",value:function(){var t=this.layout.value;t.current=t.anchor=null,t.selectClear(),this._kick.next()}},{key:"selectByModel",value:function(t){this.next();var e=this.layout.value,n=e.find(t);e.current=e.anchor=n,e.selectClear(),e.selectSet(n,!0),this._kick.next()}},{key:"pan",value:function(t,e){var n=this,i=this.translate.value,r=i.x,a=i.y,o={moved:!1,move:function(i,c){n.translate.next({x:r-t+i,y:a-e+c}),o.moved=!0}};return o}},{key:"zoom",value:function(t,e,n){var i=this.scale.value,r=Math.min(Math.max(i*n,.125),4),a=r/i,o=this.translate.value,c=o.x,s=o.y;this.translate.next({x:t+(c-t)*a,y:e+(s-e)*a}),this.scale.next(r)}},{key:"move",value:function(t,e,n){var i=this;this.editor.value.commit();var r=0,a=0;return this.begin(),{end:function(){0===r&&0===a?i.cancel():i.commit("Move item")},move:function(o,c){i.cancel(),i.begin(),r=o-e,a=c-n;var s=i.scale.value;t.move(r/s,a/s),i.model.session.completed.next()}}}},{key:"moveElsewhere",value:function(t){var e,n=this;return this.editor.value.commit(),{end:function(){var i=e,r=Object(l.a)(i,2),a=r[0],o=r[1],c=t.model.index;(a!==t.parent||o!==c&&o!==c+1)&&n._withTransaction((function(){t.model.moveInto(a.model,o),n.selectByModel(t.model),n.commit("Move item elsewhere")}))},move:function(i,r){var a=n.translate.value,o=n.scale.value,c=n.layout.value,s=[(i-a.x)/o,(r-a.y)/o+.5*c.height];r=s[1];var u=(i=s[0])>0?1:-1;i*=u;var h=e=function e(n,a,o,c){var s=n.items.length;if(s<=0)return[n,0,a,o,c];n.model.collapsed=!1;var u=n.items[0],l=0;do{var h=n.items[l],m=o+h.y;if(m+h.item.top>r)break;if(u=h,m+.5*h.item.height>r)break}while(++l<s);if(u.item===t)return[n,l,a,o,c];var f=a+c+u.item.model.marginX+u.item.width;return f>i?[n,l,a,o,c]:e(u.item.children,f,o+u.y,u.item.height)}(u>0?c.right:c.left,.5*c.width,0,.5*c.height),m=Object(l.a)(h,5),f=m[0],d=m[1],v=m[2],p=m[3],b=m[4];p-=.5*c.height;var g=f.items.length,y=g>0?function(t){return t.y+t.item[d<g?"top":"bottom"]+.25*t.item.height}(f.items[d<g?d:g-1]):b;return"M ".concat(v*u,",").concat(p+b," C ").concat((v+.5*b)*u,",").concat(p+b," ").concat(v*u,",").concat(p+y," ").concat((v+b)*u,",").concat(p+y," a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*.5," 0 a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*-.5," 0")}}}}]),t}(),U=n(31),J=(n(50),["cursor","onPointerDown","children"]),L=r.a.forwardRef((function(t,e){var n=t.cursor,a=t.onPointerDown,o=t.children,c=Object(p.a)(t,J),s=Object(i.useState)(null),u=Object(l.a)(s,2),h=u[0],m=u[1];return r.a.createElement("div",Object.assign({ref:e,style:{cursor:h?h.cursor:n},onPointerDown:function(t){t.preventDefault(),t.stopPropagation(),h||(t.currentTarget.setPointerCapture(t.pointerId),m(a(t)))},onPointerUp:function(t){t.stopPropagation(),t.currentTarget.releasePointerCapture(t.pointerId),h&&(h.onPointerUp(t),m(null))},onPointerMove:function(t){t.stopPropagation(),h&&h.onPointerMove(t)}},c),o)})),W=r.a.createContext();function z(t){var e=Object(i.useState)(t.focused.value),n=Object(l.a)(e,2),a=n[0],o=n[1],c=Object(i.useState)(t.selected.value),s=Object(l.a)(c,2),u=s[0],h=s[1],m=Object(i.useRef)();Object(i.useLayoutEffect)((function(){t.nextSize(m.current.offsetWidth,m.current.offsetHeight);var e=t.focused.subscribe(o);return e.add(t.selected.subscribe(h)),function(){return e.unsubscribe()}}),[t]);var f=Object(i.useContext)(W),d=Object(i.useState)(a&&f.editor.value),v=Object(l.a)(d,2),p=v[0],b=v[1],g=Object(i.useRef)();return Object(i.useLayoutEffect)((function(){if(a){g.current.focus();var t=f.editor.subscribe(b);return function(){return t.unsubscribe()}}b(null)}),[f,t,a]),Object(i.useLayoutEffect)((function(){if(g.current)if(p===f.editorDefault)g.current.innerText="";else if(t.model.text!==g.current.innerText){g.current.innerText=t.model.text;var e=window.getSelection();e.removeAllRanges(),e.selectAllChildren(g.current)}}),[f,t,p]),[u,m,a?r.a.createElement("div",{style:{position:"relative"}},t.model.text,r.a.createElement("div",{ref:g,contentEditable:!0,className:"MindMap-input".concat(p===f.editorDefault?"":" active"),onInput:function(t){return f.editor.value.input(t.target.innerText)},onBlur:function(t){return f.editor.value.commit()},onKeyDown:function(t){switch(t.key){case"Enter":f.editor.value.commit();break;case"Escape":f.editor.value.cancel();break;default:return}t.preventDefault(),t.stopPropagation()},onPointerDown:function(t){return t.stopPropagation()}})):t.model.text]}function K(t){var e=t.item,n=t.direction,a=Object(i.useContext)(W),o=z(e),c=Object(l.a)(o,3),s=c[0],u=c[1],h=c[2];return r.a.createElement("div",{style:{transform:"translateX(".concat(n<0?-e.width:0,"px)")}},r.a.createElement(L,{ref:u,className:"MindMap-item".concat(s?" selected":""),onPointerDown:function(t){a.select(e,t.shiftKey,t.ctrlKey);var i=a.move(e,t.clientX*n,t.clientY);return{cursor:"grabbing",onPointerUp:function(){return i.end()},onPointerMove:function(t){return i.move(t.clientX*n,t.clientY)}}}},h),r.a.createElement("div",{style:{transform:"translateX(".concat(n<0?0:e.width,"px)")}},r.a.createElement(F,{items:e.children,direction:n,dy:e.height})))}function F(t){var e=t.items,n=t.direction,i=t.dy;return e.items.length<=0?null:e.model.collapsed?r.a.createElement("span",{className:"MindMap-collapsed",onPointerDown:function(t){return t.stopPropagation()},onClick:function(){return e.model.collapsed=!1},title:"Expand"},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},r.a.createElement("path",{d:"M 0,".concat(i," h ").concat(i*n*.25," a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*.5," 0 a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*-.5," 0")}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},e.items.map((function(t){var e=t.y,a=t.item;return r.a.createElement("path",{key:a.model.id,className:"line",d:"M 0,".concat(i," C ").concat(i*n*.5,",").concat(i," 0,").concat(e+a.height," ").concat(i*n,",").concat(e+a.height," h ").concat((a.model.marginX+a.width)*n)})}))),e.items.map((function(t){var e=t.y,a=t.item;return r.a.createElement("div",{key:a.model.id,style:{transform:"translate(".concat((i+a.model.marginX)*n,"px, ").concat(e,"px)")}},r.a.createElement(K,{item:a,direction:n}))})))}function G(t){var e=t.name,n=t.icon,i=t.action;return r.a.createElement("div",{className:"MenuItem".concat(i?"":" disabled"),title:e,onPointerDown:function(t){t.preventDefault(),i&&(t.manipulator=i(),t.manipulator)||t.stopPropagation()}},r.a.createElement(U.a,{icon:n,fixedWidth:!0}))}function H(t){var e=t.items;return r.a.createElement(r.a.Fragment,null,e.map((function(t,e){var n=Object(l.a)(t,3),i=n[0],a=n[1],o=n[2];return r.a.createElement(G,{key:e,name:i,icon:a,action:o})})))}function q(){var t=Object(i.useContext)(W),e=Object(i.useState)(t.layout.value),n=Object(l.a)(e,2),a=n[0],o=n[1],c=Object(i.useState)(a.current.value),s=Object(l.a)(c,2),u=s[0],h=s[1],m=Object(i.useState)(t.translate.value),f=Object(l.a)(m,2),d=f[0],p=f[1],b=Object(i.useState)(t.scale.value),g=Object(l.a)(b,2),y=g[0],_=g[1],x=Object(i.useState)(t.manipulator.value),O=Object(l.a)(x,2),w=O[0],j=O[1];Object(i.useEffect)((function(){var e=t.layout.subscribe((function(t){o(t),h(t.current.value)}));return e.add(t.translate.subscribe(p)),e.add(t.scale.subscribe(_)),e.add(t.manipulator.subscribe(j)),function(){return e.unsubscribe()}}),[t]),Object(i.useEffect)((function(){var t=a.current.subscribe(h);return function(){return t.unsubscribe()}}),[a]);var k=z(a),E=Object(l.a)(k,3),C=E[0],S=E[1],M=E[2];Object(i.useLayoutEffect)((function(){return t.next()}));var D=Object(i.useState)({left:0,top:0,width:0,height:0}),Y=Object(l.a)(D,2),N=Y[0],T=Y[1],I=Object(i.useRef)();Object(i.useEffect)((function(){var t=new ResizeObserver((function(){return T(I.current.getBoundingClientRect())}));return t.observe(I.current),function(){return t.disconnect()}}),[]);var P=Object(i.useState)(),A=Object(l.a)(P,2),X=A[0],B=A[1],R=Object(i.useRef)(),U=Object(i.useRef)(),J=Object(i.useRef)(),K=Object(i.useRef)(),G=Object(i.useRef)(),q=Object(i.useRef)(),$=Object(i.useRef)(),Q=Object(i.useRef)(),V=Object(i.useState)([]),Z=Object(l.a)(V,2),tt=Z[0],et=Z[1];return Object(i.useLayoutEffect)((function(){if(u&&!X){var t=[].concat(Object(v.a)(u.position),[u.width,u.height]).map((function(t){return t*y})),e=Object(l.a)(t,4),n=e[0],i=e[1],r=e[2],a=e[3];n+=d.x+.5*N.width,i+=d.y+.5*N.height,et([[R,0,0,1,1],[U,.5,0,.5,1],[J,1,0,0,1],[K,1,.5,0,.5],[G,1,1,0,0],[q,.5,1,.5,0],[$,0,1,1,0],[Q,0,.5,1,.5]].map((function(t,e){var o=Object(l.a)(t,5),c=o[0],s=o[1],u=o[2],h=o[3],m=o[4],f=c.current.getBoundingClientRect();return"translate(".concat(n+r*s-f.width*h,"px, ").concat(i+a*u-f.height*m,"px)")})))}}),[a,u,d,y,w,N,X]),r.a.createElement(L,{ref:I,className:"MindMap-viewport",cursor:"grab",onPointerDown:function(e){var n=e.manipulator;if(n)return e.manipulator=null,B(n.move(e.clientX-.5*N.width,e.clientY-.5*N.height)),{cursor:"grabbing",onPointerUp:function(){B(null),n.end()},onPointerMove:function(t){return B(n.move(t.clientX-.5*N.width,t.clientY-.5*N.height))}};var i=t.pan(e.clientX,e.clientY),r=e.target===I.current;return{cursor:"grabbing",onPointerUp:function(e){i.moved||(t.editor.value.commit(),r&&t.selectClear())},onPointerMove:function(t){return i.move(t.clientX,t.clientY)}}},onWheel:function(e){return t.zoom(e.clientX-N.left-.5*N.width,e.clientY-N.top-.5*N.height,1-e.deltaY/256)},onScroll:function(e){t.translate.next({x:d.x-e.target.scrollLeft,y:d.y-e.target.scrollTop}),e.target.scroll(0,0)}},r.a.createElement("div",{className:"MindMap-content",style:{transformOrigin:"".concat(.5*N.width,"px ").concat(.5*N.height,"px"),transform:"translate(".concat(d.x,"px, ").concat(d.y,"px) scale(").concat(y,") translate(").concat(.5*N.width,"px, ").concat(.5*N.height,"px)")}},r.a.createElement("div",{style:{transform:"translate(".concat(-.5*a.width,"px, ").concat(-.5*a.height,"px)")}},r.a.createElement("div",{ref:S,className:"MindMap-root".concat(C?" selected":""),onPointerDown:function(e){return t.select(a,e.shiftKey,e.ctrlKey)}},M),r.a.createElement(F,{items:a.left,direction:-1,dy:.5*a.height}),r.a.createElement("div",{style:{transform:"translateX(".concat(a.width,"px)")}},r.a.createElement(F,{items:a.right,direction:1,dy:.5*a.height}))),X&&r.a.createElement("svg",{className:"MindMap-indicator",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1"},r.a.createElement("path",{d:X}))),!X&&[R,U,J,K,G,q,$,Q].map((function(t,e){return r.a.createElement("div",{key:e,ref:t,className:"MindMap-manipulator Menu",style:{transform:tt[e]}},r.a.createElement(H,{items:w[e]}))})))}n(51);var $=function(){var t=Object(i.useState)(0),e=Object(l.a)(t,2),n=e[0],a=e[1],o=function(){var t=Object(u.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a((function(t){return t+1})),t.prev=1,t.next=4,e();case 4:return t.abrupt("return",t.sent);case 5:return t.prev=5,a((function(t){return t-1})),t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[1,,5,8]])})));return function(e){return t.apply(this,arguments)}}(),c=Object(i.useState)(),h=Object(l.a)(c,2),m=h[0],f=h[1],v=Object(i.useState)(),p=Object(l.a)(v,2),b=p[0],g=p[1],y=Object(i.useState)(),_=Object(l.a)(y,2),x=_[0],O=_[1],w=function(t,e){window.history.replaceState(null,"",window.location.origin+window.location.pathname+t),g(e)};Object(i.useLayoutEffect)((function(){o(Object(u.a)(s.a.mark((function t(){var e,n,i,r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:e=t.sent,n=e.parseState(),i=Object(l.a)(n,2),r=i[0],a=i[1],t.t0=r,t.next="open"===t.t0?7:25;break;case 7:if(a===b){t.next=24;break}return t.t1=f,t.t2=C,t.t3=new d,t.t4=JSON,t.next=14,e.download(a);case 14:return t.t5=t.sent,t.t6=t.t4.parse.call(t.t4,t.t5),t.t7=new t.t2(t.t3,t.t6),(0,t.t1)(t.t7),g(a),t.t8=O,t.next=22,e.getName(a);case 22:t.t9=t.sent,(0,t.t8)(t.t9);case 24:return t.abrupt("break",26);case 25:""!==b&&(f(new C(new d,{text:"\u65b0\u3057\u3044\u30de\u30a4\u30f3\u30c9\u30de\u30c3\u30d7"})),g(""),O("\u65b0\u3057\u3044\u30de\u30a4\u30f3\u30c9\u30de\u30c3\u30d7"));case 26:case"end":return t.stop()}}),t)}))))}),[b]);var j=Object(i.useState)(),k=Object(l.a)(j,2),E=k[0],S=k[1];Object(i.useLayoutEffect)((function(){S(m?new R(m):null)}),[m]),Object(i.useLayoutEffect)((function(){return E?function(){return E.dispose()}:void 0}),[E]);var M=Object(i.useState)([]),D=Object(l.a)(M,2),Y=D[0],N=D[1];Object(i.useEffect)((function(){if(E){var t=E.menu.subscribe(N);return function(){return t.unsubscribe()}}N([])}),[E]);var T=Object(i.useRef)(),I=Object(i.useRef)(),P=Object(i.useRef)();return Object(i.useLayoutEffect)((function(){n>0&&P.current.focus()}),[n]),r.a.createElement("div",{className:"App"},r.a.createElement("input",{ref:T,type:"file",style:{display:"none"},onChange:function(t){return o(Object(u.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.t0=f,e.t1=C,e.t2=new d,e.t3=JSON,e.next=7,n.files[0].text();case 7:e.t4=e.sent,e.t5=e.t3.parse.call(e.t3,e.t4),e.t6=new e.t1(e.t2,e.t5),(0,e.t0)(e.t6),n.value="";case 12:case"end":return e.stop()}}),e)}))))}}),r.a.createElement("a",{ref:I,href:" ",download:!0,style:{display:"none"},onClick:function(t){t.target.href="data:application/json,"+encodeURIComponent(JSON.stringify(m.toJSON(),null,"  "))}}," "),E&&r.a.createElement(W.Provider,{value:E},r.a.createElement(q,null)),r.a.createElement("div",{className:"Menu"},r.a.createElement(G,{name:"New",icon:B.h,action:function(){return w("")}}),r.a.createElement(G,{name:"Open",icon:B.c,action:function(){E.editor.value.commit(),Object(u.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:return e=t.sent,t.next=5,e.pickFile();case 5:(n=t.sent)&&w(e.buildState(n));case 7:case"end":return t.stop()}}),t)})))()}}),r.a.createElement(G,{name:"Save",icon:B.d,action:function(){E.editor.value.commit(),Object(u.a)(s.a.mark((function t(){var e,n,i,r,a,c,u,h;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:if(e=t.sent,n=JSON.stringify(m.toJSON(),null,"  "),!b){t.next=9;break}return t.next=7,o((function(){return e.update(b,n)}));case 7:t.next=24;break;case 9:if(i=e.parseState(),r=Object(l.a)(i,2),a=r[0],c=r[1],"create"!==a){t.next=14;break}t.t0=c,t.next=17;break;case 14:return t.next=16,e.pickFolder();case 16:t.t0=t.sent;case 17:if(u=t.t0){t.next=20;break}return t.abrupt("return");case 20:return t.next=22,o((function(){return e.create(u,x,n)}));case 22:h=t.sent,w(e.buildState(h),h);case 24:case"end":return t.stop()}}),t)})))()}}),r.a.createElement("div",{className:"separator"}),r.a.createElement("div",{className:"name"},r.a.createElement("div",null,x),r.a.createElement(G,{name:"Rename",icon:B.k,action:function(){E.editor.value.commit(),o(Object(u.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:return e=t.sent,t.next=5,e.rename(b,x);case 5:(n=t.sent)&&O(n);case 7:case"end":return t.stop()}}),t)}))))}})),r.a.createElement("div",{className:"separator"}),r.a.createElement(H,{items:Y}),r.a.createElement("div",{className:"separator"}),r.a.createElement(G,{name:"Upload",icon:B.j,action:function(){E.editor.value.commit(),T.current.click()}}),r.a.createElement(G,{name:"Download",icon:B.i,action:function(){E.editor.value.commit(),I.current.click()}})),n>0&&r.a.createElement("div",{ref:P,tabIndex:"-1"},r.a.createElement("div",{className:"spinner"},r.a.createElement(U.a,{icon:B.n,size:"5x"}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[38,1,2]]]);
//# sourceMappingURL=main.1372a6a1.chunk.js.map