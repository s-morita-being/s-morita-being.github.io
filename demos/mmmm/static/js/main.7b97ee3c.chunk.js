(this["webpackJsonpmmmm-react"]=this["webpackJsonpmmmm-react"]||[]).push([[0],{32:function(t,e,n){},39:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){"use strict";n.r(e);var i=n(1),r=n.n(i),a=n(26),o=n.n(a),c=(n(32),n(6)),s=n.n(c),u=n(12),l=n(2),h=n(8),d=n(9),f=n(27),m=function(){function t(){Object(h.a)(this,t),this.undos=[],this.redos=[],this.current=null,this.completed=new f.a}return Object(d.a)(t,[{key:"_assertInTransaction",value:function(){if(null===this.current)throw new Error("must be in transaction")}},{key:"_assertNotInTransaction",value:function(){if(null!==this.current)throw new Error("must not be in transaction")}},{key:"_replay",value:function(t,e){this.begin();var n=t.pop();n.actions.forEach((function(t){return t()})),e.push({message:n.message,actions:this.current}),this.current=null,this.completed.next()}},{key:"begin",value:function(){this._assertNotInTransaction(),this.current=[]}},{key:"commit",value:function(t){this._assertInTransaction(),this.redos.length=0,this.undos.push({message:t,actions:this.current}),this.current=null,this.completed.next()}},{key:"cancel",value:function(){this._assertInTransaction();var t=this.current;this.current=[],t.forEach((function(t){return t()})),this.current=null,this.completed.next()}},{key:"clear",value:function(){this._assertNotInTransaction(),this.undos.length=this.redos.length=0}},{key:"undo",value:function(){this._replay(this.undos,this.redos)}},{key:"redo",value:function(){this._replay(this.redos,this.undos)}},{key:"record",value:function(t){this._assertInTransaction(),this.current.unshift(t)}}]),t}(),v=n(21),p=n(18),b=n(11),j=n(15),g=n(10),O=n(16),x=n(14),y=["id","marginX","marginY","children"],_=["nextID","left","right"],w=function(){function t(e){var n=e.text;Object(h.a)(this,t),this.modified=new f.a,this._text=n||""}return Object(d.a)(t,[{key:"_setText",value:function(t){var e=this,n=this._text;this.root.session.record((function(){return e._setText(n)})),this._text=t,this.modified.next()}},{key:"toJSON",value:function(){return{text:this._text}}},{key:"text",get:function(){return this._text},set:function(t){t!==this._text&&this._setText(t)}}]),t}(),k=function(t){Object(O.a)(n,t);var e=Object(x.a)(n);function n(t,i){var r,a=i.id,o=i.marginX,c=i.marginY,s=i.children,u=Object(p.a)(i,y);return Object(h.a)(this,n),(r=e.call(this,u)).root=t.parent.root,r.parent=t,r.children=new S(Object(b.a)(r),s),r.id="number"===typeof a?a:r.root._newID(),r._marginX=o||0,r._marginY=c||0,r}return Object(d.a)(n,[{key:"_setParent",value:function(t){var e=this,n=this.parent;this.root.session.record((function(){return e._setParent(n)})),this.parent=t}},{key:"_setMarginX",value:function(t){var e=this,n=this._marginX;this.root.session.record((function(){return e._setMarginX(n)})),this._marginX=t,this.modified.next()}},{key:"_setMarginY",value:function(t){var e=this,n=this._marginY;this.root.session.record((function(){return e._setMarginY(n)})),this._marginY=t,this.modified.next()}},{key:"toJSON",value:function(){return Object.assign(Object(j.a)(Object(g.a)(n.prototype),"toJSON",this).call(this),{id:this.id,marginX:0!==this._marginX?this._marginX:void 0,marginY:0!==this._marginY?this._marginY:void 0,children:this.children.toJSON()})}},{key:"index",get:function(){return this.parent._items.indexOf(this)}},{key:"remove",value:function(){var t=this.index;this.parent._splice(t,1);var e=this.parent._items;return t<e.length&&(e[t].marginY+=this._marginY),t}},{key:"isAncestorOf",value:function(t){for(var e=t.parent;e instanceof n;){if(e===this)return!0;e=e.parent.parent}return!1}},{key:"moveInto",value:function(t,e){if(this.isAncestorOf(t))throw new Error("cannot move into self");var n=this.remove();this.marginY=0,t===this.parent?e>n&&--e:this._setParent(t),t._add(e,this)}},{key:"marginX",get:function(){return this._marginX},set:function(t){t<0&&(t=0),t!==this._marginX&&this._setMarginX(t)}},{key:"marginY",get:function(){return this._marginY},set:function(t){this!==this.parent._items[0]&&t<0&&(t=0),t!==this._marginY&&this._setMarginY(t)}}]),n}(w),S=function(){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.items,a=i.collapsed;Object(h.a)(this,t),this.parent=e,this._items=r?r.map((function(t){return new k(n,t)})):[],this._collapsed=!!a}return Object(d.a)(t,[{key:"_splice",value:function(t,e){for(var n,i=this,r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];var c=(n=this._items).splice.apply(n,[t,e].concat(a));this.parent.root.session.record((function(){return i._splice.apply(i,[t,a.length].concat(Object(v.a)(c)))})),this.parent.modified.next()}},{key:"_add",value:function(t,e){if(t<this._items.length){var n=this._items[t],i=[n.marginY,0];e.marginY=i[0],n.marginY=i[1]}this._splice(t,0,e)}},{key:"toJSON",value:function(){return this._items.length>0?{items:this._items.map((function(t){return t.toJSON()})),collapsed:!!this._collapsed||void 0}:void 0}},{key:Symbol.iterator,value:function(){return this._items[Symbol.iterator]()}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new k(this,e);return this._add(t,n),n}},{key:"collapsed",get:function(){return this._collapsed}},{key:"collapsed",set:function(t){t!==this._collapsed&&(this._collapsed=t,this.parent.modified.next(),this.parent.root.session.completed.next())}}]),t}(),C=function(t){Object(O.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.nextID,o=r.left,c=r.right,s=Object(p.a)(r,_);return Object(h.a)(this,n),(i=e.call(this,s)).session=t,i._nextID=a||0,i.left=new S(Object(b.a)(i),o),i.right=new S(Object(b.a)(i),c),i}return Object(d.a)(n,[{key:"_setNextID",value:function(t){var e=this,n=this._nextID;this.session.record((function(){return e._setNextID(n)})),this._nextID=t}},{key:"_newID",value:function(){var t=this._nextID;return this._setNextID(t+1),t}},{key:"toJSON",value:function(){return Object.assign(Object(j.a)(Object(g.a)(n.prototype),"toJSON",this).call(this),{nextID:this._nextID,left:this.left.toJSON(),right:this.right.toJSON()})}},{key:"root",get:function(){return this}}]),n}(w),M=n(7),D=n(43),Y=function(){function t(e,n){var i=this;Object(h.a)(this,t),this.model=n,this.subscription=n.modified.subscribe((function(){return i._dirty()})),e?(this.width=e.nextWidth,this.height=e.nextHeight,this.focused=new D.a(e.focused.value),this.anchored=new D.a(e.anchored.value),this.selected=new D.a(e.selected.value)):(this.width=this.height=0,this.focused=new D.a(!1),this.anchored=new D.a(!1),this.selected=new D.a(!1)),this.nextWidth=this.width,this.nextHeight=this.height}return Object(d.a)(t,[{key:"nextSize",value:function(t,e){t===this.width&&e===this.height||(this.nextWidth=t,this.nextHeight=e,this._dirty())}},{key:"selectClear",value:function(){this.selected.value&&this.selected.next(!1)}}]),t}(),N=function(t){Object(O.a)(n,t);var e=Object(x.a)(n);function n(t,i,r){var a;return Object(h.a)(this,n),(a=e.call(this,t,r)).parent=i,a.children=new T(t&&t.children,Object(b.a)(a),r.children),a.top=Math.min(a.children.top,0),a.bottom=Math.max(a.children.bottom,a.height),a}return Object(d.a)(n,[{key:"_dispose",value:function(){this.subscription.unsubscribe(),this.children._dispose()}},{key:"_dirty",value:function(){this.subscription.closed||(this.subscription.unsubscribe(),this.parent.parent._dirty())}},{key:"_detach",value:function(){this.parent._detach()}},{key:"_moveX",value:function(t){var e=this.model.marginX+t;e<0&&(this.parent.parent._moveX(e),e=0),this.model.marginX=e}},{key:"_moveUpTop",value:function(t){(t+=this.top-this.children.top)>0&&this.parent._moveUpTop(t,this)}},{key:"_moveUpBottom",value:function(t){(t=this.bottom-Math.max(this.children.bottom-t,this.height))>0&&this.parent._moveUpBottom(t,this)}},{key:"_moveDownTop",value:function(t){(t=Math.min(this.children.top+t,0)-this.top)>0&&this.parent._moveDownTop(t,this)}},{key:"_moveDownBottom",value:function(t){(t-=this.bottom-this.children.bottom)>0&&this.parent._moveDownBottom(t,this)}},{key:"move",value:function(t,e){this.subscription.closed||this._detach(),this._moveX(t),this.parent._moveY(e,this)}},{key:"selectClear",value:function(){Object(j.a)(Object(g.a)(n.prototype),"selectClear",this).call(this),this.children._selectClear()}},{key:"position",get:function(){for(var t=0,e=0,n=this;;){t+=n.model.marginX;var i=n.parent;if(e+=i.items[i.indexOf(n)].y,(n=i.parent)instanceof I)return t+=.5*(n.width+n.height),i===n.left&&(t=-t-this.width),[t,e-.5*n.height];t+=n.width+n.height}}}]),n}(Y),T=function(){function t(e,n,i,r){var a=this;Object(h.a)(this,t),this.parent=n,this.model=i;var o=e?new Map(e.items.map((function(t){return[t.item.model,t.item]}))):new Map;this.items=Array.from(i,(function(t){var e=o.get(t);return o.delete(t),!e||e.subscription.closed?e=new N(e,a,t):e.parent=a,{item:e,y:t.marginY}}));var c,s=Object(M.a)(o.values());try{for(s.s();!(c=s.n()).done;){c.value._dispose()}}catch(O){s.e(O)}finally{s.f()}var u=this.items.length;if(u<=0)this.top=this.bottom=0;else if(i.collapsed){this.top=this.bottom=0;var l,d=Object(M.a)(this.items);try{for(d.s();!(l=d.n()).done;){l.value.y=0}}catch(O){d.e(O)}finally{d.f()}}else{var f=this.items[0],m=f.y;this.top=m+f.item.top;for(var v=0;this.bottom=f.y+f.item.bottom,!(++v>=u);)(f=this.items[v]).y+=this.bottom-f.item.top;var p=.5*(f.y-m);this.top-=p,this.bottom-=p;var b,j=Object(M.a)(this.items);try{for(j.s();!(b=j.n()).done;){b.value.y-=p}}catch(O){j.e(O)}finally{j.f()}}var g=function(t){var e,n=Object(M.a)(a.items);try{for(n.s();!(e=n.n()).done;){var i=e.value.item;if(i[t].value)return i;var r=i.children[t];if(r)return r}}catch(O){n.e(O)}finally{n.f()}return null};this.focused=g("focused"),this.anchored=g("anchored"),this.selecteds=this.items.reduce((function(t,e){var n=e.item;return t+(n.selected.value?1:0)+n.children.selecteds}),0)}return Object(d.a)(t,[{key:"_dispose",value:function(){var t,e=Object(M.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item._dispose()}}catch(n){e.e(n)}finally{e.f()}}},{key:"_detach",value:function(){var t,e=Object(M.a)(this.items.values());try{for(e.s();!(t=e.n()).done;){t.value.item.subscription.unsubscribe()}}catch(n){e.e(n)}finally{e.f()}this.parent._detach()}},{key:"__moveUpTop",value:function(t,e){for(;e>0;--e){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY-=.5*t,this.parent._moveUpTop(t)}},{key:"_moveUpTop",value:function(t,e){var n=this.indexOf(e);n>0?this.__moveUpTop(t,n):this.parent._moveUpTop(t)}},{key:"_moveUpBottom",value:function(t,e){var n=this.indexOf(e)+1;n<this.items.length?this.items[n].item.model.marginY+=t:this.parent._moveUpBottom(t)}},{key:"_moveDownTop",value:function(t,e){var n=this.indexOf(e);n>0?this.items[n].item.model.marginY+=t:this.parent._moveDownTop(t)}},{key:"__moveDownBottom",value:function(t,e){for(;++e<this.items.length;){var n=this.items[e].item.model;if(t<=n.marginY)return void(n.marginY-=t);t-=n.marginY,n.marginY=0}this.items[0].item.model.marginY+=.5*t,this.parent._moveDownBottom(t)}},{key:"_moveDownBottom",value:function(t,e){var n=this.indexOf(e);n+1<this.items.length?this.__moveDownBottom(t,n):this.parent._moveDownBottom(t)}},{key:"_moveY",value:function(t,e){var n=this.indexOf(e);t<0?(t=-t,this.__moveUpTop(t,n),n+1<this.items.length?this.items[n+1].item.model.marginY+=t:(this.items[0].item.model.marginY-=.5*t,this.parent._moveUpBottom(t))):t>0&&(this.__moveDownBottom(t,n),n>0?this.items[n].item.model.marginY+=t:(this.items[0].item.model.marginY+=.5*t,this.parent._moveDownTop(t)))}},{key:"_selectClear",value:function(){if(!(this.selecteds<=0)){var t,e=Object(M.a)(this.items);try{for(e.s();!(t=e.n()).done;){t.value.item.selectClear()}}catch(n){e.e(n)}finally{e.f()}this.selecteds=0}}},{key:"indexOf",value:function(t){return this.items.findIndex((function(e){return e.item===t}))}}]),t}(),I=function(t){Object(O.a)(n,t);var e=Object(x.a)(n);function n(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(h.a)(this,n),(i=e.call(this,r,t)).left=new T(r&&r.left,Object(b.a)(i),t.left),i.right=new T(r&&r.right,Object(b.a)(i),t.right),i._current=new D.a(i._getCurrent("focused")),i}return Object(d.a)(n,[{key:"_dirty",value:function(){this.subscription.unsubscribe()}},{key:"_detach",value:function(){this.subscription.unsubscribe()}},{key:"_find",value:function(t){return t===this.model.left?this.left:t===this.model.right?this.right:this.find(t.parent).children}},{key:"_moveX",value:function(t){}},{key:"_moveUpTop",value:function(t){}},{key:"_moveUpBottom",value:function(t){}},{key:"_moveDownTop",value:function(t){}},{key:"_moveDownBottom",value:function(t){}},{key:"_path",value:s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===this){t.next=6;break}return t.next=3,e;case 3:e=e.parent.parent,t.next=0;break;case 6:case"end":return t.stop()}}),t,this)}))},{key:"_getCurrent",value:function(t){return this[t].value?this:this.left[t]||this.right[t]}},{key:"_setCurrent",value:function(t,e){var n=this._getCurrent(t);if(e===n)return!1;if(n){var i,r=Object(M.a)(this._path(n));try{for(r.s();!(i=r.n()).done;){i.value.parent[t]=null}}catch(c){r.e(c)}finally{r.f()}n[t].next(!1)}if(e){var a,o=Object(M.a)(this._path(e));try{for(o.s();!(a=o.n()).done;){a.value.parent[t]=e}}catch(c){o.e(c)}finally{o.f()}e[t].next(!0)}return!0}},{key:"dispose",value:function(){this.subscription.unsubscribe(),this.left._dispose(),this.right._dispose()}},{key:"next",value:function(){return this.subscription.closed?new n(this.model,this):this}},{key:"find",value:function(t){return t===this.model?this:this._find(t.parent).items[t.index].item}},{key:"current",get:function(){return this._current},set:function(t){this._setCurrent("focused",t)&&this._current.next(this._getCurrent("focused"))}},{key:"anchor",get:function(){return this._getCurrent("anchored")},set:function(t){this._setCurrent("anchored",t)}},{key:"selectClear",value:function(){Object(j.a)(Object(g.a)(n.prototype),"selectClear",this).call(this),this.left._selectClear(),this.right._selectClear()}},{key:"selectSet",value:function(t,e){if(e!==t.selected.value){t.selected.next(e);var n,i=e?1:-1,r=Object(M.a)(this._path(t));try{for(r.s();!(n=r.n()).done;){n.value.parent.selecteds+=i}}catch(a){r.e(a)}finally{r.f()}}}},{key:"selectRange",value:function(t,e){for(var n=this,i=function(t){var e,i=[],r=Object(M.a)(n._path(t));try{for(r.s();!(e=r.n()).done;){var a=e.value;i.unshift(a)}}catch(o){r.e(o)}finally{r.f()}return i.unshift(n),i},r=[i(t),i(e)],a=r[0],o=r[1];a.length>1&&o.length>1&&a[1].parent===o[1].parent;)a.shift(),o.shift();var c=function t(e,i){if(n.selectSet(e,!0),--i>0){var r,a=Object(M.a)(e.children.items);try{for(a.s();!(r=a.n()).done;){t(r.value.item,i)}}catch(o){a.e(o)}finally{a.f()}}},s=function(t,e,i){for(;t.length>1;){--e,t.shift(),n.selectSet(t[0],!0);for(var r=t[0].parent.items,a=i(t[0]),o=Object(l.a)(a,2),s=o[0],u=o[1];s<u;++s)c(r[s].item,e)}if(--e>0){var h,d=Object(M.a)(t[0].children.items);try{for(d.s();!(h=d.n()).done;){var f=h.value;c(f.item,e)}}catch(m){d.e(m)}finally{d.f()}}},u=function(t){return s(a,t,(function(t){return[t.parent.indexOf(t)+1,t.parent.items.length]}))},h=function(t){return s(o,t,(function(t){return[0,t.parent.indexOf(t)]}))},d=Math.max(a.length,o.length);if(this.selectSet(a[0],!0),a[0]===this){if(a.length>1&&o.length>1&&a[1].parent===this.right){var f=[o,a];a=f[0],o=f[1]}a.length>1&&u(d),o.length>1&&h(d)}else{var m=a[0].parent,v=[m.indexOf(a[0]),m.indexOf(o[0])],p=v[0],b=v[1];if(p===b)(a.length>1?u:h)(d);else{if(this.selectSet(o[0],!0),p>b){var j=[o,a,b,p];a=j[0],o=j[1],p=j[2],b=j[3]}for(u(d);++p<b;)c(m.items[p].item,d);h(d)}}}},{key:"position",get:function(){return[.5*-this.width,.5*-this.height]}}]),n}(Y),P=n(4),A=function(){function t(e){var n=this;Object(h.a)(this,t),this.model=e,this.layout=new D.a(new I(e)),this.translate=new D.a({x:0,y:0}),this.scale=new D.a(1),this.editorDefault={input:function(t){var e=n.layout.value.current.value.model,i=e.text;n.begin(),e.text=t,n.editor.next({input:function(t){n.cancel(),n.begin(),e.text=t,n.model.session.completed.next()},commit:function(){n.editor.next(n.editorDefault),e.text===i?n.cancel():n.commit("Edit")},cancel:function(){n.editor.next(n.editorDefault),n.cancel()}}),n.model.session.completed.next()},commit:function(){},cancel:function(){}},this.editor=new D.a(this.editorDefault);var i=this.model.session,r=i.undos,a=i.redos,o=function(){return[["Undo".concat(r.length>0?" - ".concat(r[r.length-1].message):""),P.q,r.length>0?function(){return n._editorCommitAnd((function(){return i.undo()}))}:null],["Redo".concat(a.length>0?" - ".concat(a[a.length-1].message):""),P.m,a.length>0?function(){return n._editorCommitAnd((function(){return i.redo()}))}:null]]};this.menu=new D.a(o());var c=function(){if(n.editor.value!==n.editorDefault)return[[["Cancel (Esc)",P.o,function(){return n.editor.value.cancel()}]],[],[["Commit (Enter)",P.b,function(){return n.editor.value.commit()}]],[],[],[],[],[]];var t=n.layout.value;if(!t.current.value)return[[],[],[],[],[],[],[],[]];var e=function(){return n._editorCommitAnd((function(){return n.editor.value.input(n.layout.value.current.value.model.text)}))},i=function(t,e){return t.collapsed?["Expand ".concat(e),P.g,function(){return n._editorCommitAnd((function(){return t.collapsed=!1}))}]:["Collapse ".concat(e),P.e,function(){return n._editorCommitAnd((function(){return t.collapsed=!0}))}]};if(t.current.value===t)return[[],[],[["Edit",P.f,e]],t.right.items.length>0?[i(t.model.right,"Right Items")]:[["Add Right",P.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.right.add(0,{text:"Right"})),n.commit("Add right")}))}))}]],[],[],[],t.left.items.length>0?[i(t.model.left,"Left Items")]:[["Add Left",P.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.model.left.add(0,{text:"Left"})),n.commit("Add left")}))}))}]]];for(var r=[[],[["Add Above",P.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index,{text:"Above"})),n.commit("Add item above")}))}))}]],[["Edit",P.f,e]],t.current.value.children.items.length>0?[i(t.current.value.model.children,"Children")]:[["Add Child",P.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){n.selectByModel(n.layout.value.current.value.model.children.add(0,{text:"Child"})),n.commit("Add child")}))}))}]],[],[["Add Below",P.l,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=n.layout.value.current.value.model;n.selectByModel(t.parent.add(t.index+1,{text:"Below"})),n.commit("Add item below")}))}))}]],[["Delete",P.p,function(){return n._editorCommitAnd((function(){return n._withTransaction((function(){var t=function t(e){if(!(e.selecteds<=0)){var n,i=Object(M.a)(e.items);try{for(i.s();!(n=i.n()).done;){var r=n.value.item;r.selected.value?r.model.remove():t(r.children)}}catch(a){i.e(a)}finally{i.f()}}},e=n.layout.value;t(e.left),t(e.right),n.commit("Delete items")}))}))}]],[["Move Elsewhere",P.a,function(){return n.moveElsewhere(n.layout.value.current.value)}]]],a=t.current.value.parent;a.parent!==t;)a=a.parent.parent;return a===t.left?[r[2],r[1],r[0],r[7],r[6],r[5],r[4],r[3]]:r};this.manipulator=new D.a(c()),this._saved=i.undos.length,this.modified=new D.a(!1),this._invalid=!1,this.completed=i.completed.subscribe((function(){n.next(),n._invalid=!0})),this._validate=new f.a,this._validate.subscribe((function(){n.menu.next(o()),n.manipulator.next(c());var t=i.undos.length!==n._saved;t!==n.modified.value&&n.modified.next(t)}))}return Object(d.a)(t,[{key:"_withTransaction",value:function(t){this.begin();try{t()}catch(e){this.cancel()}}},{key:"_editorCommitAnd",value:function(t){this.editor.value.commit(),t()}},{key:"dispose",value:function(){this.completed.unsubscribe(),this.layout.value.dispose()}},{key:"next",value:function(){var t=this.layout.value,e=t.next();e!==t&&this.layout.next(e)}},{key:"validate",value:function(){this.next(),this._invalid&&(this._invalid=!1,this._validate.next())}},{key:"markSaved",value:function(){this._saved=this.model.session.undos.length,this._invalid=!0}},{key:"begin",value:function(){this.model.session.begin()}},{key:"commit",value:function(t){this.model.session.commit(t),this._saved>=this.model.session.undos.length&&(this._saved=-1)}},{key:"cancel",value:function(){this.model.session.cancel()}},{key:"select",value:function(t,e,n){var i=this.layout.value;i.current=t,e?(i.anchor||(i.anchor=t),n||i.selectClear(),i.selectRange(i.anchor,t)):(i.anchor=t,n?i.selectSet(t,!t.selected.value):t.selected.value||(i.selectClear(),i.selectSet(t,!0))),this._invalid=!0}},{key:"selectClear",value:function(){var t=this.layout.value;t.current=t.anchor=null,t.selectClear(),this._invalid=!0}},{key:"selectByModel",value:function(t){this.next();var e=this.layout.value,n=e.find(t);e.current=e.anchor=n,e.selectClear(),e.selectSet(n,!0),this._invalid=!0}},{key:"pan",value:function(t,e){var n=this,i=this.translate.value,r=i.x,a=i.y,o={moved:!1,move:function(i,c){n.translate.next({x:r-t+i,y:a-e+c}),o.moved=!0}};return o}},{key:"zoom",value:function(t,e,n){var i=this.scale.value,r=Math.min(Math.max(i*n,.125),4),a=r/i,o=this.translate.value,c=o.x,s=o.y;this.translate.next({x:t+(c-t)*a,y:e+(s-e)*a}),this.scale.next(r)}},{key:"move",value:function(t,e,n){var i=this;this.editor.value.commit();var r=0,a=0;return this.begin(),{end:function(){0===r&&0===a?i.cancel():i.commit("Move item")},move:function(o,c){i.cancel(),i.begin(),r=o-e,a=c-n;var s=i.scale.value;t.move(r/s,a/s),i.model.session.completed.next()}}}},{key:"moveElsewhere",value:function(t){var e,n=this;return this.editor.value.commit(),{end:function(){var i=e,r=Object(l.a)(i,2),a=r[0],o=r[1],c=t.model.index;(a!==t.parent||o!==c&&o!==c+1)&&n._withTransaction((function(){t.model.moveInto(a.model,o),n.selectByModel(t.model),n.commit("Move item elsewhere")}))},move:function(i,r){var a=n.translate.value,o=n.scale.value,c=n.layout.value,s=[(i-a.x)/o,(r-a.y)/o+.5*c.height];r=s[1];var u=(i=s[0])>0?1:-1;i*=u;var h=e=function e(n,a,o,c){var s=n.items.length;if(s<=0)return[n,0,a,o,c];n.model.collapsed=!1;var u=n.items[0],l=0;do{var h=n.items[l],d=o+h.y;if(d+h.item.top>r)break;if(u=h,d+.5*h.item.height>r)break}while(++l<s);if(u.item===t)return[n,l,a,o,c];var f=a+c+u.item.model.marginX+u.item.width;return f>i?[n,l,a,o,c]:e(u.item.children,f,o+u.y,u.item.height)}(u>0?c.right:c.left,.5*c.width,0,.5*c.height),d=Object(l.a)(h,5),f=d[0],m=d[1],v=d[2],p=d[3],b=d[4];p-=.5*c.height;var j=f.items.length,g=j>0?function(t){return t.y+t.item[m<j?"top":"bottom"]+.25*t.item.height}(f.items[m<j?m:j-1]):b;return"M ".concat(v*u,",").concat(p+b," C ").concat((v+.5*b)*u,",").concat(p+b," ").concat(v*u,",").concat(p+g," ").concat((v+b)*u,",").concat(p+g," a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*.5," 0 a ").concat(.25*b," ").concat(.25*b," 0 0 0 ").concat(b*u*-.5," 0")}}}}]),t}(),X=n(20),B=n(25),E=(n(39),n(0)),R=["cursor","onPointerDown","children"],U=r.a.forwardRef((function(t,e){var n=t.cursor,r=t.onPointerDown,a=t.children,o=Object(p.a)(t,R),c=Object(i.useState)(null),s=Object(l.a)(c,2),u=s[0],h=s[1];return Object(E.jsx)("div",Object(B.a)(Object(B.a)({ref:e,style:{cursor:u?u.cursor:n},onPointerDown:function(t){t.preventDefault(),t.stopPropagation(),u||(t.currentTarget.setPointerCapture(t.pointerId),h(r(t)))},onPointerUp:function(t){t.stopPropagation(),t.currentTarget.releasePointerCapture(t.pointerId),u&&(u.onPointerUp(t),h(null))},onPointerMove:function(t){t.stopPropagation(),u&&u.onPointerMove(t)}},o),{},{children:a}))})),J=r.a.createContext();function L(t){var e=Object(i.useState)(t.focused.value),n=Object(l.a)(e,2),r=n[0],a=n[1],o=Object(i.useState)(t.selected.value),c=Object(l.a)(o,2),s=c[0],u=c[1],h=Object(i.useRef)();Object(i.useLayoutEffect)((function(){t.nextSize(h.current.offsetWidth,h.current.offsetHeight);var e=t.focused.subscribe(a);return e.add(t.selected.subscribe(u)),function(){return e.unsubscribe()}}),[t]);var d=Object(i.useContext)(J),f=Object(i.useState)(r&&d.editor.value),m=Object(l.a)(f,2),v=m[0],p=m[1],b=Object(i.useRef)();return Object(i.useLayoutEffect)((function(){if(r){b.current.focus();var t=d.editor.subscribe(p);return function(){return t.unsubscribe()}}p(null)}),[d,t,r]),Object(i.useLayoutEffect)((function(){if(b.current)if(v===d.editorDefault)b.current.innerText="";else if(t.model.text!==b.current.innerText){b.current.innerText=t.model.text;var e=window.getSelection();e.removeAllRanges(),e.selectAllChildren(b.current)}}),[d,t,v]),[s,h,r?Object(E.jsxs)("div",{style:{position:"relative"},children:[t.model.text,Object(E.jsx)("div",{ref:b,contentEditable:!0,className:"MindMap-input".concat(v===d.editorDefault?"":" active"),onInput:function(t){return d.editor.value.input(t.target.innerText)},onBlur:function(t){return d.editor.value.commit()},onKeyDown:function(t){switch(t.key){case"Enter":d.editor.value.commit();break;case"Escape":d.editor.value.cancel();break;default:return}t.preventDefault(),t.stopPropagation()},onPointerDown:function(t){return t.stopPropagation()}})]}):t.model.text]}function W(t){var e=t.item,n=t.direction,r=Object(i.useContext)(J),a=L(e),o=Object(l.a)(a,3),c=o[0],s=o[1],u=o[2];return Object(E.jsxs)("div",{style:{transform:"translateX(".concat(n<0?-e.width:0,"px)")},children:[Object(E.jsx)(U,{ref:s,className:"MindMap-item".concat(c?" selected":""),onPointerDown:function(t){r.select(e,t.shiftKey,t.ctrlKey);var i=r.move(e,t.clientX*n,t.clientY);return{cursor:"grabbing",onPointerUp:function(){i.end(),r.validate()},onPointerMove:function(t){return i.move(t.clientX*n,t.clientY)}}},children:u}),Object(E.jsx)("div",{style:{transform:"translateX(".concat(n<0?0:e.width,"px)")},children:Object(E.jsx)(z,{items:e.children,direction:n,dy:e.height})})]})}function z(t){var e=t.items,n=t.direction,i=t.dy;return e.items.length<=0?null:e.model.collapsed?Object(E.jsx)("span",{className:"MindMap-collapsed",onPointerDown:function(t){return t.stopPropagation()},onClick:function(){return e.model.collapsed=!1},title:"Expand",children:Object(E.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",children:Object(E.jsx)("path",{d:"M 0,".concat(i," h ").concat(i*n*.25," a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*.5," 0 a ").concat(.25*i," ").concat(.25*i," 0 0 0 ").concat(i*n*-.5," 0")})})}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",children:e.items.map((function(t){var e=t.y,r=t.item;return Object(E.jsx)("path",{className:"line",d:"M 0,".concat(i," C ").concat(i*n*.5,",").concat(i," 0,").concat(e+r.height," ").concat(i*n,",").concat(e+r.height," h ").concat((r.model.marginX+r.width)*n)},r.model.id)}))}),e.items.map((function(t){var e=t.y,r=t.item;return Object(E.jsx)("div",{style:{transform:"translate(".concat((i+r.model.marginX)*n,"px, ").concat(e,"px)")},children:Object(E.jsx)(W,{item:r,direction:n})},r.model.id)}))]})}function K(t){var e=t.name,n=t.icon,i=t.action;return Object(E.jsx)("div",{className:"MenuItem".concat(i?"":" disabled"),title:e,onPointerDown:function(t){t.preventDefault(),i&&(t.manipulator=i(),t.manipulator)||t.stopPropagation()},children:Object(E.jsx)(X.a,{icon:n,fixedWidth:!0})})}function F(t){var e=t.items;return Object(E.jsx)(E.Fragment,{children:e.map((function(t,e){var n=Object(l.a)(t,3),i=n[0],r=n[1],a=n[2];return Object(E.jsx)(K,{name:i,icon:r,action:a},e)}))})}function G(){var t=Object(i.useContext)(J),e=Object(i.useState)(t.layout.value),n=Object(l.a)(e,2),r=n[0],a=n[1],o=Object(i.useState)(r.current.value),c=Object(l.a)(o,2),s=c[0],u=c[1],h=Object(i.useState)(t.translate.value),d=Object(l.a)(h,2),f=d[0],m=d[1],p=Object(i.useState)(t.scale.value),b=Object(l.a)(p,2),j=b[0],g=b[1],O=Object(i.useState)(t.manipulator.value),x=Object(l.a)(O,2),y=x[0],_=x[1];Object(i.useEffect)((function(){var e=t.layout.subscribe((function(t){a(t),u(t.current.value)}));return e.add(t.translate.subscribe(m)),e.add(t.scale.subscribe(g)),e.add(t.manipulator.subscribe(_)),function(){return e.unsubscribe()}}),[t]),Object(i.useEffect)((function(){var t=r.current.subscribe(u);return function(){return t.unsubscribe()}}),[r]);var w=L(r),k=Object(l.a)(w,3),S=k[0],C=k[1],M=k[2];Object(i.useLayoutEffect)((function(){return t.validate()}));var D=Object(i.useState)({left:0,top:0,width:0,height:0}),Y=Object(l.a)(D,2),N=Y[0],T=Y[1],I=Object(i.useRef)();Object(i.useEffect)((function(){var t=new ResizeObserver((function(){return T(I.current.getBoundingClientRect())}));return t.observe(I.current),function(){return t.disconnect()}}),[]);var P=Object(i.useState)(),A=Object(l.a)(P,2),X=A[0],B=A[1],R=Object(i.useRef)(),W=Object(i.useRef)(),K=Object(i.useRef)(),G=Object(i.useRef)(),H=Object(i.useRef)(),q=Object(i.useRef)(),$=Object(i.useRef)(),Q=Object(i.useRef)(),V=Object(i.useState)([]),Z=Object(l.a)(V,2),tt=Z[0],et=Z[1];return Object(i.useLayoutEffect)((function(){if(s&&!X){var t=[].concat(Object(v.a)(s.position),[s.width,s.height]).map((function(t){return t*j})),e=Object(l.a)(t,4),n=e[0],i=e[1],r=e[2],a=e[3];n+=f.x+.5*N.width,i+=f.y+.5*N.height,et([[R,0,0,1,1],[W,.5,0,.5,1],[K,1,0,0,1],[G,1,.5,0,.5],[H,1,1,0,0],[q,.5,1,.5,0],[$,0,1,1,0],[Q,0,.5,1,.5]].map((function(t,e){var o=Object(l.a)(t,5),c=o[0],s=o[1],u=o[2],h=o[3],d=o[4],f=c.current.getBoundingClientRect();return"translate(".concat(n+r*s-f.width*h,"px, ").concat(i+a*u-f.height*d,"px)")})))}}),[r,s,f,j,y,N,X]),Object(E.jsxs)(U,{ref:I,className:"MindMap-viewport",cursor:"grab",onPointerDown:function(e){var n=e.manipulator;if(n)return e.manipulator=null,B(n.move(e.clientX-.5*N.width,e.clientY-.5*N.height)),{cursor:"grabbing",onPointerUp:function(){B(null),n.end()},onPointerMove:function(t){return B(n.move(t.clientX-.5*N.width,t.clientY-.5*N.height))}};var i=t.pan(e.clientX,e.clientY),r=e.target===I.current;return{cursor:"grabbing",onPointerUp:function(e){i.moved||(t.editor.value.commit(),r&&t.selectClear())},onPointerMove:function(t){return i.move(t.clientX,t.clientY)}}},onWheel:function(e){return t.zoom(e.clientX-N.left-.5*N.width,e.clientY-N.top-.5*N.height,1-e.deltaY/256)},onScroll:function(e){t.translate.next({x:f.x-e.target.scrollLeft,y:f.y-e.target.scrollTop}),e.target.scroll(0,0)},children:[Object(E.jsxs)("div",{className:"MindMap-content",style:{transformOrigin:"".concat(.5*N.width,"px ").concat(.5*N.height,"px"),transform:"translate(".concat(f.x,"px, ").concat(f.y,"px) scale(").concat(j,") translate(").concat(.5*N.width,"px, ").concat(.5*N.height,"px)")},children:[Object(E.jsxs)("div",{style:{transform:"translate(".concat(-.5*r.width,"px, ").concat(-.5*r.height,"px)")},children:[Object(E.jsx)("div",{ref:C,className:"MindMap-root".concat(S?" selected":""),onPointerDown:function(e){return t.select(r,e.shiftKey,e.ctrlKey)},children:M}),Object(E.jsx)(z,{items:r.left,direction:-1,dy:.5*r.height}),Object(E.jsx)("div",{style:{transform:"translateX(".concat(r.width,"px)")},children:Object(E.jsx)(z,{items:r.right,direction:1,dy:.5*r.height})})]}),X&&Object(E.jsx)("svg",{className:"MindMap-indicator",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",children:Object(E.jsx)("path",{d:X})})]}),!X&&[R,W,K,G,H,q,$,Q].map((function(t,e){return Object(E.jsx)("div",{ref:t,className:"MindMap-manipulator Menu",style:{transform:tt[e]},children:Object(E.jsx)(F,{items:y[e]})},e)}))]})}n(41);var H=function(){var t=Object(i.useState)(0),e=Object(l.a)(t,2),n=e[0],r=e[1],a=function(){var t=Object(u.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r((function(t){return t+1})),t.prev=1,t.next=4,e();case 4:return t.abrupt("return",t.sent);case 5:return t.prev=5,r((function(t){return t-1})),t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[1,,5,8]])})));return function(e){return t.apply(this,arguments)}}(),o=Object(i.useState)(),c=Object(l.a)(o,2),h=c[0],d=c[1],f=Object(i.useState)(),v=Object(l.a)(f,2),p=v[0],b=v[1],j=Object(i.useState)(),g=Object(l.a)(j,2),O=g[0],x=g[1],y=function(t,e){window.history.replaceState(null,"",window.location.origin+window.location.pathname+t),b(e)};Object(i.useLayoutEffect)((function(){a(Object(u.a)(s.a.mark((function t(){var e,n,i,r,a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:e=t.sent,n=e.parseState(),i=Object(l.a)(n,2),r=i[0],a=i[1],t.t0=r,t.next="open"===t.t0?7:25;break;case 7:if(a===p){t.next=24;break}return t.t1=d,t.t2=C,t.t3=new m,t.t4=JSON,t.next=14,e.download(a);case 14:return t.t5=t.sent,t.t6=t.t4.parse.call(t.t4,t.t5),t.t7=new t.t2(t.t3,t.t6),(0,t.t1)(t.t7),b(a),t.t8=x,t.next=22,e.getName(a);case 22:t.t9=t.sent,(0,t.t8)(t.t9);case 24:return t.abrupt("break",26);case 25:""!==p&&(d(new C(new m,{text:"\u65b0\u3057\u3044\u30de\u30a4\u30f3\u30c9\u30de\u30c3\u30d7"})),b(""),x("\u65b0\u3057\u3044\u30de\u30a4\u30f3\u30c9\u30de\u30c3\u30d7"));case 26:case"end":return t.stop()}}),t)}))))}),[p]);var _=Object(i.useState)(),w=Object(l.a)(_,2),k=w[0],S=w[1];Object(i.useLayoutEffect)((function(){S(h?new A(h):null)}),[h]),Object(i.useLayoutEffect)((function(){return k?function(){return k.dispose()}:void 0}),[k]);var M=Object(i.useState)([]),D=Object(l.a)(M,2),Y=D[0],N=D[1],T=Object(i.useState)(),I=Object(l.a)(T,2),B=I[0],R=I[1];Object(i.useEffect)((function(){if(k){var t=k.menu.subscribe(N);return t.add(k.modified.subscribe(R)),function(){return t.unsubscribe()}}N([])}),[k]);var U=Object(i.useRef)(),L=Object(i.useRef)(),W=Object(i.useRef)();return Object(i.useLayoutEffect)((function(){n>0&&W.current.focus()}),[n]),Object(E.jsxs)("div",{className:"App",children:[Object(E.jsx)("input",{ref:U,type:"file",style:{display:"none"},onChange:function(t){return a(Object(u.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.t0=d,e.t1=C,e.t2=new m,e.t3=JSON,e.next=7,n.files[0].text();case 7:e.t4=e.sent,e.t5=e.t3.parse.call(e.t3,e.t4),e.t6=new e.t1(e.t2,e.t5),(0,e.t0)(e.t6),n.value="";case 12:case"end":return e.stop()}}),e)}))))}}),Object(E.jsx)("a",{ref:L,href:" ",download:!0,style:{display:"none"},onClick:function(t){t.target.href="data:application/json,"+encodeURIComponent(JSON.stringify(h.toJSON(),null,"  "))},children:" "}),k&&Object(E.jsx)(J.Provider,{value:k,children:Object(E.jsx)(G,{})}),Object(E.jsxs)("div",{className:"Menu",children:[Object(E.jsx)(K,{name:"New",icon:P.h,action:function(){return y("")}}),Object(E.jsx)(K,{name:"Open",icon:P.c,action:function(){null===k||void 0===k||k.editor.value.commit(),Object(u.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:return e=t.sent,t.next=5,e.pickFile();case 5:(n=t.sent)&&y(e.buildState(n));case 7:case"end":return t.stop()}}),t)})))()}}),Object(E.jsx)(K,{name:"Save",icon:P.d,action:k&&function(){k.editor.value.commit(),Object(u.a)(s.a.mark((function t(){var e,n,i,r,o,c,u,d;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:if(e=t.sent,n=JSON.stringify(h.toJSON(),null,"  "),!p){t.next=9;break}return t.next=7,a((function(){return e.update(p,n)}));case 7:t.next=24;break;case 9:if(i=e.parseState(),r=Object(l.a)(i,2),o=r[0],c=r[1],"create"!==o){t.next=14;break}t.t0=c,t.next=17;break;case 14:return t.next=16,e.pickFolder();case 16:t.t0=t.sent;case 17:if(u=t.t0){t.next=20;break}return t.abrupt("return");case 20:return t.next=22,a((function(){return e.create(u,O,n)}));case 22:d=t.sent,y(e.buildState(d),d);case 24:k.markSaved();case 25:case"end":return t.stop()}}),t)})))()}}),B&&Object(E.jsx)("div",{children:"!"}),Object(E.jsx)("div",{className:"separator"}),Object(E.jsxs)("div",{className:"name",children:[Object(E.jsx)("div",{children:O}),Object(E.jsx)(K,{name:"Rename",icon:P.k,action:k&&function(){k.editor.value.commit(),a(Object(u.a)(s.a.mark((function t(){var e,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.GAPI();case 2:return e=t.sent,t.next=5,e.rename(p,O);case 5:(n=t.sent)&&x(n);case 7:case"end":return t.stop()}}),t)}))))}})]}),Object(E.jsx)("div",{className:"separator"}),Object(E.jsx)(F,{items:Y}),Object(E.jsx)("div",{className:"separator"}),Object(E.jsx)(K,{name:"Upload",icon:P.j,action:function(){null===k||void 0===k||k.editor.value.commit(),U.current.click()}}),Object(E.jsx)(K,{name:"Download",icon:P.i,action:k&&function(){k.editor.value.commit(),L.current.click()}})]}),n>0&&Object(E.jsx)("div",{ref:W,tabIndex:"-1",children:Object(E.jsx)("div",{className:"spinner",children:Object(E.jsx)(X.a,{icon:P.n,size:"5x"})})})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsx)(H,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[42,1,2]]]);
//# sourceMappingURL=main.7b97ee3c.chunk.js.map